<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบตรวจสอบพ่อค้า (Merchant Verify)</title>
    
    <!-- 1. โหลดไลบรารีที่จำเป็น (React, Tailwind, Babel) จาก CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- ฟอนต์ภาษาไทยสวยๆ -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <!-- 2. ส่วนของโค้ด React (Logic การทำงาน) -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ตั้งค่า Google Sheets ตรงนี้ ---
        const SPREADSHEET_ID = '1PQkLSV5H98zaMp2qU6isgBbfNYjEIHwop6fWX0MVZC4';
        const GID = '0';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${GID}`;
        
        // เริ่มอ่านข้อมูลจากบรรทัดที่ 7 (A7) -> Index 6
        const DATA_START_INDEX = 6;

        // --- ไอคอน SVG (เขียนเองเพื่อให้ไฟล์เดียวจบไม่ต้องโหลดเพิ่ม) ---
        const Icons = {
            ShieldCheck: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>,
            UserCheck: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>,
            Phone: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            Facebook: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>,
            AlertTriangle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
            RefreshCw: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            ExternalLink: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            CheckCircle2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Briefcase: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
            Hash: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>
        };

        const App = () => {
            const [merchants, setMerchants] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');

            const fetchData = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(CSV_URL);
                    if (!response.ok) throw new Error('เชื่อมต่อ Google Sheets ไม่สำเร็จ');
                    
                    const csvText = await response.text();
                    if (csvText.trim().startsWith('<!DOCTYPE')) {
                        throw new Error('กรุณาตั้งค่า Google Sheets เป็น "ทุกคนที่มีลิงก์" (Anyone with the link)');
                    }

                    const rows = csvText.split('\n');
                    if (rows.length <= DATA_START_INDEX) throw new Error('ไม่พบข้อมูลในบรรทัดที่กำหนด');

                    const parseCSVRow = (row) => {
                        const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
                        return row.split(regex).map(cell => cell.replace(/^"|"$/g, '').trim());
                    };

                    const jsonData = rows.slice(DATA_START_INDEX).map((row, index) => {
                        if (!row.trim()) return null;
                        const cells = parseCSVRow(row);
                        
                        let rawLink = cells[3] || '';
                        if (rawLink && !rawLink.startsWith('http://') && !rawLink.startsWith('https://')) {
                            rawLink = `https://${rawLink}`;
                        }

                        return {
                            _id: index,
                            code: cells[0] || '',       // Col A
                            name: cells[1] || '-',      // Col B
                            fbName: cells[2] || '-',    // Col C
                            fbLink: rawLink,            // Col D
                            phone: cells[4] || '-',     // Col E
                            service: cells[5] || '-'    // Col F
                        };
                    }).filter(item => item !== null && item.code !== '');

                    setMerchants(jsonData);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => { fetchData(); }, []);

            const filteredMerchants = useMemo(() => {
                const term = searchTerm.trim().toUpperCase();
                if (!term) return [];
                return merchants.filter(item => {
                    const codeVal = item.code.toUpperCase();
                    const parts = codeVal.split(/[- ]+/);
                    return codeVal === term || parts.some(part => part === term);
                });
            }, [searchTerm, merchants]);

            return (
                <div className="min-h-screen pb-10">
                    {/* Top Alert */}
                    <div className="bg-red-600 text-white px-4 py-2 text-center text-[10px] md:text-xs font-bold uppercase tracking-widest sticky top-0 z-30 shadow-md flex items-center justify-center gap-2">
                        <span className="w-4 h-4"><Icons.AlertTriangle /></span>
                        <span>ระวังตัวปลอม! เช็คชื่อและเลขบัญชีให้ตรงก่อนโอน</span>
                    </div>

                    <div className="max-w-md mx-auto px-4 py-6">
                        {/* Header */}
                        <div className="flex items-center gap-3 mb-6">
                            <div className="bg-blue-600 p-3 rounded-2xl text-white shadow-lg shadow-blue-200">
                                <span className="w-7 h-7 block"><Icons.ShieldCheck /></span>
                            </div>
                            <div>
                                <h1 className="text-xl font-black text-slate-800">ระบบเช็คพ่อค้า</h1>
                                <p className="text-xs font-bold text-slate-400 uppercase tracking-widest">VIP/MVP Verification</p>
                            </div>
                        </div>

                        {/* Search Box */}
                        <div className="bg-white p-2 rounded-[1.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 mb-8 relative">
                            <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-blue-600">
                                    <span className="w-5 h-5"><Icons.Hash /></span>
                                </div>
                                <input
                                    type="text"
                                    placeholder="พิมพ์เลขรหัส (เช่น 1657)"
                                    className="block w-full pl-12 pr-12 py-4 bg-transparent border-none text-xl font-black text-slate-800 placeholder:text-slate-300 focus:outline-none"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                                {searchTerm && (
                                    <button onClick={() => setSearchTerm('')} className="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-300 hover:text-slate-500">
                                        <span className="w-6 h-6"><Icons.X /></span>
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Content */}
                        {loading ? (
                            <div className="text-center py-12">
                                <div className="animate-spin w-8 h-8 text-blue-500 mx-auto mb-3"><Icons.RefreshCw /></div>
                                <p className="text-xs font-bold text-slate-400">กำลังเชื่อมต่อฐานข้อมูล...</p>
                            </div>
                        ) : error ? (
                            <div className="bg-red-50 p-6 rounded-2xl text-center border border-red-100">
                                <div className="text-red-500 w-8 h-8 mx-auto mb-2"><Icons.AlertTriangle /></div>
                                <p className="text-red-700 font-bold text-sm">{error}</p>
                            </div>
                        ) : !searchTerm ? (
                            <div className="text-center py-10 opacity-40">
                                <div className="w-12 h-12 mx-auto mb-2 text-slate-400"><Icons.CheckCircle2 /></div>
                                <p className="font-bold text-slate-500">รอการค้นหา</p>
                                <p className="text-xs text-slate-400">ค้นหาเฉพาะรหัสที่ตรงเป๊ะๆ</p>
                            </div>
                        ) : filteredMerchants.length > 0 ? (
                            <div className="space-y-6">
                                <div className="flex items-center gap-2 px-2">
                                    <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                    <span className="text-xs font-bold text-slate-500 uppercase tracking-widest">พบข้อมูลที่ตรงกัน</span>
                                </div>

                                {filteredMerchants.map((m) => (
                                    <div key={m._id} className="bg-white rounded-[2rem] shadow-xl shadow-slate-200 overflow-hidden border border-slate-100 animate-in">
                                        
                                        {/* Card Header */}
                                        <div className="bg-blue-600 px-6 py-4 flex items-center justify-between text-white">
                                            <div>
                                                <p className="text-[10px] font-black uppercase opacity-70 tracking-widest">Merchant Code</p>
                                                <h2 className="text-3xl font-black tracking-tight">{m.code}</h2>
                                            </div>
                                            <div className="bg-white/20 p-2 rounded-xl w-10 h-10 flex items-center justify-center">
                                                <Icons.CheckCircle2 />
                                            </div>
                                        </div>

                                        <div className="p-6 space-y-4">
                                            {/* Name */}
                                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100/50">
                                                <div className="flex items-center gap-2 mb-1 text-slate-400">
                                                    <span className="w-4 h-4"><Icons.UserCheck /></span>
                                                    <span className="text-[10px] font-black uppercase tracking-wider">ชื่อ-นามสกุล</span>
                                                </div>
                                                <p className="text-lg font-bold text-slate-800">{m.name}</p>
                                            </div>

                                            {/* Facebook */}
                                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100/50">
                                                <div className="flex items-center gap-2 mb-1 text-slate-400">
                                                    <span className="w-4 h-4"><Icons.Facebook /></span>
                                                    <span className="text-[10px] font-black uppercase tracking-wider">Facebook</span>
                                                </div>
                                                <p className="text-base font-bold text-slate-800">{m.fbName}</p>
                                                {m.fbLink && (
                                                    <a href={m.fbLink} target="_blank" rel="noopener noreferrer" 
                                                       className="flex items-center justify-center gap-2 mt-3 bg-blue-600 text-white px-4 py-3 rounded-xl text-sm font-bold hover:bg-blue-700 transition-all w-full shadow-md shadow-blue-200 active:scale-95">
                                                        <span className="w-4 h-4"><Icons.ExternalLink /></span> ไปที่หน้าโปรไฟล์
                                                    </a>
                                                )}
                                            </div>

                                            {/* Phone */}
                                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100/50">
                                                <div className="flex items-center gap-2 mb-1 text-slate-400">
                                                    <span className="w-4 h-4"><Icons.Phone /></span>
                                                    <span className="text-[10px] font-black uppercase tracking-wider">เบอร์โทรศัพท์</span>
                                                </div>
                                                <p className="text-lg font-mono font-bold text-slate-800">{m.phone}</p>
                                            </div>

                                            {/* Service */}
                                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100/50">
                                                <div className="flex items-center gap-2 mb-1 text-slate-400">
                                                    <span className="w-4 h-4"><Icons.Briefcase /></span>
                                                    <span className="text-[10px] font-black uppercase tracking-wider">รายละเอียดบริการ</span>
                                                </div>
                                                <p className="text-sm font-medium text-slate-700 whitespace-pre-line leading-relaxed">{m.service}</p>
                                            </div>
                                        </div>

                                        <div className="px-6 py-4 bg-amber-50 border-t border-amber-100 flex gap-3">
                                            <span className="w-5 h-5 text-amber-500 shrink-0"><Icons.AlertTriangle /></span>
                                            <p className="text-xs font-bold text-amber-800 leading-relaxed">
                                                ข้อมูลนี้อ้างอิงจากรหัส <span className="font-black">{m.code}</span> <br/>
                                                หากบัญชีโอนเงินไม่ตรงกับชื่อนี้ <span className="underline decoration-2 text-red-600">ห้ามโอนเงินเด็ดขาด</span>
                                            </p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="bg-white border-2 border-dashed border-red-200 rounded-[2rem] p-8 text-center mt-4">
                                <div className="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-3 text-red-500">
                                    <span className="w-8 h-8"><Icons.X /></span>
                                </div>
                                <h3 className="text-red-600 font-black text-lg">ไม่พบรหัส "{searchTerm}"</h3>
                                <p className="text-slate-500 text-sm mt-1">กรุณาตรวจสอบตัวเลขอีกครั้ง</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


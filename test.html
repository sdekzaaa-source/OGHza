<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OGH Farm - SDekza RO</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        input, button, select, textarea { outline: none; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom, 20px); }

        /* YouTube Card */
        .yt-card-horizontal { display: inline-flex; align-items: center; max-width: 100%; background-color: #1e293b; border-radius: 50px; padding: 4px 4px 4px 8px; font-family: 'Inter', sans-serif; border: 1px solid #334155; transition: all 0.2s ease-in-out; gap: 8px; text-decoration: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .yt-card-horizontal:hover { border-color: #475569; background-color: #334155; transform: translateY(-1px); }
        .yt-avatar { width: 28px; height: 28px; border-radius: 50%; background-image: url('https://yt3.googleusercontent.com/vlD4rkRPBg-HIUX6kAbuW1AHgE1FzYa4cs7W3ZD1AV0z4Xg_vM42d1r_slf8SVPhjmJXPslvcg=s160-c-k-c0x00ffffff-no-rj'); background-size: cover; border: 1px solid #475569; }
        .yt-info { display: flex; flex-direction: column; justify-content: center; margin-right: 4px; }
        .yt-name { font-size: 0.75rem; font-weight: 700; color: #f1f5f9; margin: 0; line-height: 1; }
        .yt-stats { font-size: 0.55rem; color: #94a3b8; margin-top: 1px; }
        .yt-btn { display: flex; align-items: center; justify-content: center; padding: 0 10px; height: 24px; background-color: #dc2626; color: #fff; border-radius: 14px; font-weight: 700; font-size: 0.65rem; transition: background-color 0.2s; }
        .yt-btn:hover { background-color: #ef4444; }

        .btn-google { background-color: #f8fafc; color: #1e293b; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: center; gap: 12px; padding: 14px 24px; border-radius: 16px; font-weight: 800; font-size: 14px; transition: all 0.2s; cursor: pointer; width: 100%; max-width: 320px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .btn-google:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .btn-guest { background-color: transparent; color: #64748b; border: 1px solid #334155; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 8px 16px; border-radius: 12px; font-weight: 600; font-size: 11px; transition: all 0.2s; cursor: pointer; width: auto; margin: 0 auto; max-width: 200px; }
        .btn-guest:hover { background-color: #1e293b; color: white; border-color: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
      import { getFirestore, doc, setDoc, getDoc, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
      window.FirebaseSDK = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, getFirestore, doc, setDoc, getDoc, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc };
    </script>

    <script type="text/babel">
        // --- CONFIG & GLOBAL SVGs ---
        const OWNER_CONFIG = { apiKey: "AIzaSyAbWzr8o_OhkjGbEetBYq_nzYmVZ2fTf40", authDomain: "rocogh-88a38.firebaseapp.com", projectId: "rocogh-88a38", storageBucket: "rocogh-88a38.firebasestorage.app", messagingSenderId: "1025971309206", appId: "1:1025971309206:web:d4f9e0ab6bb016dde590b7", measurementId: "G-04JN1ERQ4T" };

        const { useState, useEffect, useMemo, useRef } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = window.Recharts || {};

        const SVGs = {
            Google: () => <svg width="20" height="20" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>,
            Spell: ({className}) => <svg viewBox="0 0 32 32" className={className} shapeRendering="crispEdges"><path d="M16 4 L24 12 L24 22 L16 28 L8 22 L8 12 Z" fill="#7E57C2" /><path d="M16 6 L22 12 L22 20 L16 26 L10 20 L10 12 Z" fill="#9575CD" /><rect x="13" y="10" width="2" height="2" fill="#EDE7F6" /></svg>,
            Gum: ({className}) => <svg viewBox="0 0 32 32" className={className} shapeRendering="crispEdges"><rect x="6" y="14" width="20" height="8" fill="#42A5F5" /><circle cx="16" cy="12" r="6" fill="#F06292" /></svg>,
            Silvervine: ({className}) => <svg viewBox="0 0 32 32" className={className} shapeRendering="crispEdges"><rect x="8" y="10" width="16" height="14" fill="#5D4037" /><rect x="14" y="4" width="4" height="6" fill="#4CAF50" /><rect x="14" y="14" width="4" height="4" fill="#FFD600" /></svg>,
            Magic: ({className}) => <svg viewBox="0 0 32 32" className={className} shapeRendering="crispEdges"><circle cx="16" cy="16" r="10" fill="#EF5350" /><circle cx="16" cy="16" r="6" fill="#B71C1C" /><path d="M16 6 L18 10 L22 10 L20 14 L22 18 L18 18 L16 22 L14 18 L10 18 L12 14 L10 10 L14 10 Z" fill="#FFCDD2" opacity="0.5"/></svg>
        };

        const CoagulatedSpell16Bit = ({ className }) => <SVGs.Spell className={className} />;
        const ContaminatedMagic16Bit = ({ className }) => <SVGs.Magic className={className} />;
        const BubbleGum16Bit = ({ className }) => <SVGs.Gum className={className} />;
        const Silvervine16Bit = ({ className }) => <SVGs.Silvervine className={className} />;

        const Icon = ({ name, size = 16, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    ref.current.innerHTML = '';
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    i.setAttribute('class', className);
                    ref.current.appendChild(i);
                    window.lucide.createIcons({ root: ref.current, nameAttr: 'data-lucide', attrs: { width: size, height: size } });
                }
            }, [name, size, className]);
            return <span ref={ref} style={{ display: 'inline-flex', verticalAlign: 'middle' }}></span>;
        };

        // --- WELCOME SCREEN ---
        const WelcomeScreen = ({ onLogin, onGuest }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-slate-950 p-6 text-center animate-fade-in relative overflow-hidden">
                <div className="absolute top-1/4 left-1/4 w-64 h-64 bg-purple-600/10 rounded-full blur-[120px] animate-pulse"></div>
                <div className="absolute bottom-1/4 right-1/4 w-64 h-64 bg-blue-600/10 rounded-full blur-[120px] animate-pulse"></div>
                <div className="relative mb-12 transform hover:scale-105 transition-transform duration-500">
                    <div className="w-48 h-48 md:w-56 md:h-56 bg-gradient-to-br from-slate-800 to-slate-900 rounded-[4rem] flex items-center justify-center shadow-2xl border-2 border-slate-700/50 rotate-3">
                        <SVGs.Spell className="w-28 h-28 md:w-32 md:h-32 drop-shadow-2xl" />
                    </div>
                    <div className="absolute -bottom-2 -right-2 bg-purple-600 text-white text-[11px] font-black px-5 py-2 rounded-full shadow-lg border-2 border-slate-950 uppercase tracking-widest -rotate-6">SDekza RO</div>
                </div>
                <h1 className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-purple-500 to-pink-500 mb-4 tracking-tighter italic uppercase">OGH Farming</h1>
                <p className="text-slate-400 text-sm mb-12 font-medium leading-relaxed max-w-xs mx-auto">ระบบบันทึกสถิติและวิเคราะห์กำไร<br/><span className="text-slate-600 text-xs mt-1 block uppercase tracking-widest italic">Ragnarok Online Classic / GGT</span></p>
                <div className="space-y-6 w-full max-w-xs relative z-10">
                    <button onClick={onLogin} className="btn-google mx-auto group"><SVGs.Google /> <span>เข้าสู่ระบบด้วย Gmail</span></button>
                    <button onClick={onGuest} className="btn-guest"><Icon name="user" size={14} /> <span>ใช้งานแบบ Guest</span></button>
                </div>
                <div className="mt-16 opacity-60 hover:opacity-100 transition-opacity">
                    <a href="https://www.youtube.com/@SDekza-RO" target="_blank" className="yt-card-horizontal"><div className="yt-avatar"></div><div className="yt-info"><h2 className="yt-name">SDekza RO</h2><div className="yt-stats">140+ Subs</div></div><div className="yt-btn"><Icon name="youtube" size={12}/> Subscribe</div></a>
                </div>
            </div>
        );

        const App = () => {
            const formatZeny = (n) => new Intl.NumberFormat('th-TH').format(Math.round(n||0));
            const formatMZeny = (n) => (Number(n||0)/1000000).toFixed(2)+" M";
            const formatTimer = (ms) => {
                const m = Math.floor(ms/60000).toString().padStart(2,'0');
                const s = Math.floor((ms%60000)/1000).toString().padStart(2,'0');
                const c = Math.floor((ms%1000)/10).toString().padStart(2,'0');
                return `${m}:${s}:${c}`;
            };

            const [records, setRecords] = useState(() => JSON.parse(localStorage.getItem('ogh_records')) || []);
            const [globalPrices, setGlobalPrices] = useState(() => JSON.parse(localStorage.getItem('ogh_prices')) || { purpleStonePrice:0, contMagicPrice:0, gumBoxPrice:0, silvervineBoxPrice:0 });
            const [activeTab, setActiveTab] = useState('ogh');
            const [isAdding, setIsAdding] = useState(false);
            const [showManual, setShowManual] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [chartMode, setChartMode] = useState('profit');
            const [sortOrder, setSortOrder] = useState('date-desc');
            const [expandedId, setExpandedId] = useState(null);
            const [timeInMs, setTimeInMs] = useState(0);
            const [isTimerActive, setIsTimerActive] = useState(false);
            const [isTimerPaused, setIsTimerPaused] = useState(true);
            const [isGuestMode, setIsGuestMode] = useState(false);
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const timerRef = useRef(null);

            const [formData, setFormData] = useState({ 
                date: new Date().toLocaleDateString('en-GB'), 
                gumUsed: 0, trashAmount: "", purpleStoneCount: "", contMagicCount: "", 
                isSellingSpell: false, isSellingMagic: false, useSilvervine: true, 
                minutesUsed: 60, notes: "", otherCosts: [] 
            });

            // Firebase logic
            useEffect(() => {
                const init = async () => {
                    if (window.FirebaseSDK) {
                        try {
                            const { initializeApp, getAuth, getFirestore, onAuthStateChanged } = window.FirebaseSDK;
                            const app = initializeApp(OWNER_CONFIG);
                            window.auth = getAuth(app);
                            window.db = getFirestore(app);
                            onAuthStateChanged(window.auth, (u) => {
                                setUser(u);
                                setIsLoading(false);
                                if(u) syncData(u.uid);
                            });
                        } catch(e) { setIsLoading(false); }
                    } else { setIsLoading(false); }
                };
                setTimeout(init, 500); 
            }, []);

            const syncData = (uid) => {
                if (!window.FirebaseSDK || !window.db) return;
                const { collection, query, onSnapshot, doc, getDoc } = window.FirebaseSDK;
                const q = query(collection(window.db, 'artifacts', 'ro-farm-app', 'users', uid, 'farm_records'));
                onSnapshot(q, (snap) => setRecords(snap.docs.map(d => ({id:d.id, ...d.data()}))));
                getDoc(doc(window.db, 'artifacts', 'ro-farm-app', 'users', uid, 'settings', 'prices')).then(s => { if(s.exists()) setGlobalPrices(s.data()); });
            };

            useEffect(() => { if (!user) localStorage.setItem('ogh_records', JSON.stringify(records)); }, [records, user]);
            useEffect(() => { if (!user) localStorage.setItem('ogh_prices', JSON.stringify(globalPrices)); }, [globalPrices, user]);
            useEffect(() => {
                if(isTimerActive && !isTimerPaused) { timerRef.current = setInterval(() => setTimeInMs(p => p+10), 10); } 
                else { clearInterval(timerRef.current); }
                return () => clearInterval(timerRef.current);
            }, [isTimerActive, isTimerPaused]);

            const handleTimerStart = () => { setIsTimerActive(true); setIsTimerPaused(false); };
            const handleTimerPause = () => { setIsTimerPaused(true); };
            const handleTimerStop = () => { const m = Math.ceil(timeInMs/60000); setFormData(p => ({...p, minutesUsed: m>0?m:1})); setIsTimerActive(false); setIsTimerPaused(true); };
            const handleTimerReset = () => { setTimeInMs(0); setIsTimerActive(false); setIsTimerPaused(true); };
            const handleLogin = async () => { if(!window.auth) return; try { await window.FirebaseSDK.signInWithPopup(window.auth, new window.FirebaseSDK.GoogleAuthProvider()); } catch(e) { alert("Login Failed"); } };
            const handleLogout = () => { if(window.auth) { window.FirebaseSDK.signOut(window.auth).then(() => { setUser(null); setIsGuestMode(false); window.location.reload(); }); } };
            const handleExitGuest = () => { setIsGuestMode(false); setUser(null); setRecords([]); window.location.reload(); };

            const addOtherCostField = () => setFormData(p => ({...p, otherCosts:[...p.otherCosts, {name:"", amount:""}]}));
            const removeOtherCostField = (i) => setFormData(p => ({...p, otherCosts:p.otherCosts.filter((_,x)=>x!==i)}));
            const updateOtherCost = (i, f, v) => { const n = [...formData.otherCosts]; n[i][f] = v; setFormData(p => ({...p, otherCosts:n})); };

            const handleSave = async (e) => {
                e.preventDefault();
                const p = { ...globalPrices };
                const d = { 
                    ...formData, 
                    id: editingId || Date.now(), timestamp: Date.now(), mode: activeTab, prices: p, 
                    revenue: Number(formData.trashAmount||0) + (formData.isSellingSpell?(Number(formData.purpleStoneCount||0)*p.purpleStonePrice):0) + (activeTab==='aogh' && formData.isSellingMagic ? (Number(formData.contMagicCount||0)*p.contMagicPrice) : 0),
                    totalCost: (formData.gumUsed*(p.gumBoxPrice/10)) + (formData.useSilvervine?(2*(p.silvervineBoxPrice/10)) : 0) + formData.otherCosts.reduce((a,b)=>a+Number(b.amount||0),0)
                };
                d.profit = d.revenue - d.totalCost; d.revenuePerMinute = d.minutesUsed > 0 ? d.revenue / d.minutesUsed : 0;
                if (user && window.db && !isGuestMode) { await window.FirebaseSDK.setDoc(window.FirebaseSDK.doc(window.db, 'artifacts', 'ro-farm-app', 'users', user.uid, 'farm_records', String(d.id)), d); }
                else { setRecords(prev => editingId ? prev.map(r => r.id === editingId ? d : r) : [d, ...prev]); }
                setIsAdding(false); setEditingId(null);
                setFormData({ date: new Date().toLocaleDateString('en-GB'), gumUsed: 0, trashAmount: "", purpleStoneCount: "", contMagicCount: "", isSellingSpell: false, isSellingMagic: false, useSilvervine: true, minutesUsed: 60, notes: "", otherCosts: [] });
            };

            const handleDelete = (id) => {
                if (user && window.db && !isGuestMode) window.FirebaseSDK.deleteDoc(window.FirebaseSDK.doc(window.db, 'artifacts', 'ro-farm-app', 'users', user.uid, 'farm_records', String(id)));
                else setRecords(prev => prev.filter(r => r.id !== id));
            };

            const startEdit = (r) => {
                setFormData({ ...r, contMagicCount: r.contMagicCount || "", isSellingMagic: r.isSellingMagic || false, useSilvervine: r.useSilvervine !== false });
                setEditingId(r.id); setIsAdding(true);
            };

            const processedData = useMemo(() => {
                const runsPerDate = {}; records.forEach(r => { if(r.useSilvervine!==false) { const d=r.date; runsPerDate[d]=(runsPerDate[d]||0)+1; } });
                return records.filter(r => (r.mode || 'ogh') === activeTab).map(r => {
                    const p = r.prices || globalPrices;
                    const rev = Number(r.trashAmount||0) + (r.isSellingSpell?(Number(r.purpleStoneCount||0)*p.purpleStonePrice):0) + ((r.mode==='aogh'&&r.isSellingMagic)?(Number(r.contMagicCount||0)*p.contMagicPrice):0);
                    let svCost = 0; if(r.useSilvervine!==false) { const c=runsPerDate[r.date]||1; svCost=(2*(p.silvervineBoxPrice/10))/c; }
                    const totalCost = (r.gumUsed*(p.gumBoxPrice/10)) + svCost + (r.otherCosts||[]).reduce((a,b)=>a+Number(b.amount||0),0);
                    return { ...r, revenue:rev, totalCost, profit:rev-totalCost, gumCost:(r.gumUsed*(p.gumBoxPrice/10)), silvervineCost:svCost, revenuePerMinute:r.minutesUsed>0?rev/r.minutesUsed:0 };
                }).sort((a,b) => b.timestamp - a.timestamp);
            }, [records, activeTab, globalPrices]);

            const stats = useMemo(() => {
                if(!processedData.length) return { totalProfit:0, avgRevenue:0, maxRevenue:0, minRevenue:0, avgRevenuePerMinute:0, totalStoredStones:0, totalStoredMagic:0 };
                const revs = processedData.map(r => r.revenue);
                return {
                    totalProfit: processedData.reduce((a,b)=>a+b.profit,0),
                    avgRevenue: revs.reduce((a,b)=>a+b,0)/revs.length,
                    maxRevenue: Math.max(...revs),
                    minRevenue: Math.min(...revs),
                    avgRevenuePerMinute: processedData.reduce((a,b)=>a+b.revenuePerMinute,0)/processedData.length,
                    totalStoredStones: processedData.reduce((a,b)=>a+(!b.isSellingSpell?Number(b.purpleStoneCount||0):0),0),
                    totalStoredMagic: processedData.reduce((a,b)=>a+(!b.isSellingMagic?Number(b.contMagicCount||0):0),0)
                };
            }, [processedData]);

            // --- RENDER SECTIONS ---
            const renderStats = () => (
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 animate-fade-in">
                    <div className="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] shadow-xl"><div className="p-3 bg-green-500/10 rounded-xl text-green-500 w-fit mb-4"><Icon name="wallet" size={24} /></div><h3 className="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">กำไรรวมสุทธิ</h3><p className="text-3xl font-black">{formatMZeny(stats.totalProfit)} <span className="text-sm text-slate-600 font-bold ml-1">Z</span></p></div>
                    <div className="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] shadow-xl relative border-b-blue-500/30"><div className="p-3 bg-blue-500/10 rounded-xl text-blue-500 w-fit mb-4"><Icon name="trending-up" size={24} /></div><h3 className="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">ยอดขายเฉลี่ย</h3><p className="text-3xl font-black">{formatMZeny(stats.avgRevenue)} <span className="text-sm text-slate-600 font-bold ml-1">Z</span></p><div className="flex flex-wrap items-center gap-2 mt-2 text-[10px] font-bold uppercase text-slate-500"><span className="text-green-500 flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded"><Icon name="arrow-up" size={10}/> {formatMZeny(stats.maxRevenue)}</span><span className="text-red-500 flex items-center gap-1 bg-red-500/10 px-2 py-1 rounded"><Icon name="arrow-down" size={10}/> {formatMZeny(stats.minRevenue)}</span></div></div>
                    <div className="bg-slate-900 border border-slate-800 p-6 rounded-[2rem] shadow-xl border-b-amber-500/30">
                        <div className="p-3 bg-amber-500/10 rounded-xl text-amber-500 w-fit mb-4"><Icon name="archive" size={24} /></div>
                        <h3 className="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">มูลค่าในคลังสะสม</h3>
                        <p className="text-3xl font-black">{formatMZeny((stats.totalStoredStones * globalPrices.purpleStonePrice) + (stats.totalStoredMagic * globalPrices.contMagicPrice))} <span className="text-sm text-slate-600 font-bold ml-1">Z</span></p>
                        <div className="mt-2 space-y-1">
                            <div className="text-[10px] text-amber-400 font-bold flex justify-between uppercase"><span>Spell:</span> <span>{stats.totalStoredStones.toLocaleString()} ea</span></div>
                            {activeTab === 'aogh' && <div className="text-[10px] text-rose-400 font-bold flex justify-between uppercase border-t border-slate-800/50 pt-1"><span>Magic:</span> <span>{stats.totalStoredMagic.toLocaleString()} ea</span></div>}
                        </div>
                    </div>
                </div>
            );

            const renderDashboard = () => (
                <div className="space-y-8 animate-fade-in">
                    {/* Chart */}
                    <div className="bg-slate-900 border border-slate-800 p-6 md:p-8 rounded-[2.5rem] shadow-xl h-[450px] flex flex-col">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-black uppercase tracking-tight flex items-center gap-3 italic"><Icon name="trending-up" className="text-green-500"/> สถิติ</h2>
                            <div className="flex bg-slate-950 p-1 rounded-2xl border border-slate-800">
                                <button onClick={() => setChartMode('profit')} className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${chartMode === 'profit' ? 'bg-purple-600 text-white shadow' : 'text-slate-500'}`}>กำไร</button>
                                <button onClick={() => setChartMode('revenue')} className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all ${chartMode === 'revenue' ? 'bg-green-600 text-white shadow' : 'text-slate-500'}`}>รายได้</button>
                            </div>
                        </div>
                        <div className="flex-1 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={[...processedData].reverse()}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" vertical={false} />
                                    <XAxis dataKey="date" stroke="#475569" fontSize={10} axisLine={false} tickLine={false} />
                                    <YAxis stroke="#475569" fontSize={10} tickFormatter={v => `${v/1000}k`} axisLine={false} tickLine={false} />
                                    <Tooltip contentStyle={{ backgroundColor: '#0f172a', border: '1px solid #1e293b', borderRadius: '16px' }} formatter={v => [formatZeny(v), chartMode === 'profit' ? 'กำไร' : 'รายได้']} />
                                    <Line type="monotone" dataKey={chartMode} stroke={chartMode==='profit'?'#a855f7':'#10b981'} strokeWidth={4} dot={{ r: 4 }} />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                    {/* History */}
                    <div className="bg-slate-900 border border-slate-800 rounded-[2.5rem] shadow-xl overflow-hidden">
                        <div className="p-8 border-b border-slate-800 flex justify-between items-center"><h2 className="text-xl font-black text-blue-400 italic flex items-center gap-3 tracking-tight uppercase"><Icon name="history" /> ประวัติการฟาร์ม</h2><select value={sortOrder} onChange={e => setSortOrder(e.target.value)} className="bg-slate-950 text-[10px] font-black uppercase p-2 rounded-xl border border-slate-800 text-slate-300 outline-none"><option value="date-desc">ล่าสุด</option><option value="date-asc">เก่าสุด</option></select></div>
                        <div className="overflow-x-auto custom-scrollbar"><table className="w-full text-left text-xs"><thead className="bg-slate-900/50 border-b border-slate-800"><tr><th className="px-6 py-4 font-black text-slate-500 uppercase tracking-widest whitespace-nowrap">วันที่</th><th className="px-6 py-4 font-black text-slate-500 uppercase tracking-widest whitespace-nowrap">ข้อมูลการฟาร์ม</th><th className="px-6 py-4 text-right text-[10px] font-black text-slate-500 uppercase tracking-widest whitespace-nowrap">กำไรสุทธิ</th><th className="px-6 py-4 text-center text-[10px] font-black text-slate-500 uppercase tracking-widest whitespace-nowrap">จัดการ</th></tr></thead><tbody className="divide-y divide-slate-800/50">{processedData.map(record => (<React.Fragment key={record.id}><tr className="hover:bg-white/[0.02] cursor-pointer transition-colors" onClick={() => setExpandedId(expandedId === record.id ? null : record.id)}><td className="px-6 py-4 font-bold text-sm text-slate-300 whitespace-nowrap">{record.date} {expandedId===record.id?<Icon name="chevron-up" size={14}/>:<Icon name="chevron-down" size={14}/>}</td><td className="px-6 py-4 whitespace-nowrap"><div className="flex gap-2"><span className="bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded-lg text-[9px] font-black border border-blue-500/20">GUM {record.gumUsed}</span><span className="bg-purple-500/10 text-purple-400 px-2 py-0.5 rounded-lg text-[9px] font-black border border-purple-500/20">{record.purpleStoneCount} ea</span></div></td><td className={`px-6 py-4 text-right font-black text-lg ${record.profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>{formatZeny(record.profit)}</td><td className="px-6 py-4 text-center whitespace-nowrap"><div className="flex justify-center gap-2"><button onClick={(e) => { e.stopPropagation(); startEdit(record); }} className="text-slate-500 hover:text-purple-400 p-2"><Icon name="pencil" size={14} /></button><button onClick={(e) => { e.stopPropagation(); handleDelete(record.id); }} className="text-slate-500 hover:text-red-500 p-2"><Icon name="trash-2" size={14} /></button></div></td></tr>{expandedId === record.id && (<tr className="bg-slate-950/30 animate-fade-in"><td colSpan="4" className="px-6 py-4"><div className="grid grid-cols-2 md:grid-cols-4 gap-6 text-[10px] text-slate-400"><div><p className="font-black text-slate-500 mb-1 uppercase tracking-tighter">รายรับ</p><p>Trash: {formatZeny(record.trashAmount)}</p><p>Total: <span className="text-green-400 font-black">{formatZeny(record.revenue)} Z</span></p></div><div><p className="font-black text-slate-500 mb-1 uppercase tracking-tighter">ต้นทุน</p><p>Gum: {formatZeny(record.gumCost)}</p><p>Silvervine: {formatZeny(record.silvervineCost)}</p><p>Total: <span className="text-red-400 font-black">{formatZeny(record.totalCost)} Z</span></p></div><div><p className="font-black text-slate-500 mb-1 uppercase tracking-tighter">เวลา</p><p>{record.minutesUsed} นาที</p><p>Avg: {formatZeny(record.revenuePerMinute)} Z/m</p></div><div><p className="font-black text-slate-500 mb-1 uppercase tracking-tighter">Memo</p><p className="italic leading-relaxed">{record.notes || "-"}</p></div></div></td></tr>)}</React.Fragment>))}</tbody></table></div></div>
                </div>
            );

            const renderEmptyState = () => (
                <div className="bg-slate-900 border border-slate-800 p-12 rounded-[2.5rem] shadow-xl text-center flex flex-col items-center justify-center h-[300px] animate-fade-in">
                    <div className="w-20 h-20 bg-slate-800/50 rounded-full flex items-center justify-center mb-4 border border-slate-700"><Icon name="scroll" size={40} className="text-slate-600" /></div>
                    <h3 className="text-xl font-black text-slate-300 mb-2 italic">ยังไม่มีประวัติการฟาร์ม</h3>
                    <button onClick={() => setIsAdding(true)} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg active:scale-95 text-xs uppercase"><Icon name="plus-circle" size={16} /> บันทึกรอบแรก</button>
                </div>
            );

            const renderSidebar = () => (
                <div className="space-y-6">
                    {/* Prices Card */}
                    <div className="bg-slate-900 border border-slate-800 p-8 rounded-[2.5rem] shadow-xl relative overflow-hidden">
                        <h3 className="text-sm font-black mb-6 text-indigo-400 uppercase tracking-widest flex items-center gap-3 italic"><Icon name="database" /> ราคาปัจจุบัน</h3>
                        <div className="space-y-4">
                            {[
                                { k:'purpleStonePrice', l:'Coagulated Spell', i:<CoagulatedSpell16Bit className="w-4 h-4 opacity-30"/> },
                                { k:'contMagicPrice', l:'Contaminated Magic', i:<ContaminatedMagic16Bit className="w-4 h-4 opacity-30"/> },
                                { k:'gumBoxPrice', l:'Gum Box', i:<BubbleGum16Bit className="w-4 h-4 opacity-30"/> },
                                { k:'silvervineBoxPrice', l:'Silvervine Box', i:<Silvervine16Bit className="w-3 h-3 opacity-30"/> }
                            ].map(o => (activeTab === 'ogh' && o.k === 'contMagicPrice' ? null :
                                <div key={o.k} className="bg-slate-950 p-4 rounded-2xl border border-slate-800 flex justify-between items-center group hover:border-purple-500/50 transition-all">
                                    <div className="flex items-center gap-2 text-[10px] text-slate-500 font-black">{o.i} {o.l}</div>
                                    <input type="number" value={globalPrices[o.k]} onChange={e => { const v=Number(e.target.value); setGlobalPrices(p=>({...p, [o.k]:v})); if(user&&window.db) window.FirebaseSDK.setDoc(window.FirebaseSDK.doc(window.db, 'artifacts', 'ro-farm-app', 'users', user.uid, 'settings', 'prices'), {...globalPrices, [o.k]:v}); }} className="bg-transparent text-right text-xs font-bold w-20 text-white outline-none" />
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Timer Card */}
                    <div className="bg-slate-900 border border-slate-800 p-8 rounded-[2.5rem] shadow-xl border-t-red-500/20">
                        <h3 className="text-sm font-black mb-3 text-red-400 uppercase tracking-widest flex items-center gap-2 italic uppercase"><Icon name="clock" /> จับเวลา</h3>
                        <div className="text-4xl font-black text-white tabular-nums mb-8 bg-slate-950 text-center py-6 rounded-[2rem] border border-slate-800 shadow-inner tracking-tighter">{formatTimer(timeInMs)}</div>
                        <div className="grid grid-cols-2 gap-3">
                            {!isTimerActive || isTimerPaused ? (
                                <button onClick={handleTimerStart} className="bg-green-600 hover:bg-green-500 py-4 rounded-xl font-black text-[10px] uppercase shadow-lg transition-all active:scale-95 flex items-center justify-center gap-1"><Icon name="play" size={12} fill="currentColor"/> {timeInMs > 0 ? "ต่อ" : "เริ่ม"}</button>
                            ) : (
                                <button onClick={handleTimerPause} className="bg-amber-600 hover:bg-amber-500 py-4 rounded-xl font-black text-[10px] uppercase shadow-lg transition-all active:scale-95 flex items-center justify-center gap-1"><Icon name="pause" size={12} fill="currentColor"/> พัก</button>
                            )}
                            <button onClick={handleTimerStop} className="bg-slate-800 hover:bg-red-600 py-4 rounded-xl font-black text-[10px] uppercase transition-all active:scale-95 group flex items-center justify-center gap-1 shadow-lg"><Icon name="square" size={12} fill="currentColor" className="group-hover:text-white"/> หยุด/บันทึก</button>
                            <button onClick={handleTimerReset} className="col-span-2 py-3 bg-slate-950 border border-slate-800 rounded-xl text-[9px] font-black text-slate-500 hover:text-white transition-colors">รีเซตเวลา</button>
                        </div>
                    </div>
                </div>
            );

            const renderForm = () => (
                <form onSubmit={handleSave} className="bg-slate-900 border border-slate-800 p-6 md:p-10 rounded-[2.5rem] shadow-xl animate-fade-in max-w-2xl mx-auto">
                    <div className="flex justify-between items-center mb-8"><h2 className="text-xl md:text-2xl font-black uppercase text-purple-400 italic flex items-center gap-3"><Icon name={editingId ? "pencil" : "plus-circle"} size={24} /> {editingId ? "แก้ไข" : "บันทึก"} ข้อมูล</h2><label className="flex items-center gap-2 cursor-pointer bg-slate-950 p-2 px-3 rounded-xl border border-slate-800 hover:border-slate-700 transition-all"><div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${formData.useSilvervine ? 'bg-green-500 border-green-500' : 'border-slate-600'}`}>{formData.useSilvervine && <Icon name="check" size={10} className="text-white" />}</div><input type="checkbox" className="hidden" checked={formData.useSilvervine} onChange={e => setFormData({...formData, useSilvervine: e.target.checked})} /><span className="text-[9px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-1">ใช้ Silvervine <Silvervine16Bit className="w-3 h-3"/></span></label></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"><div className="space-y-3 h-24"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2 h-4"><Icon name="calendar" size={14}/> วันที่ฟาร์ม</label><input type="text" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} className="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-white font-bold outline-none focus:ring-2 focus:ring-purple-500/50" required placeholder="DD/MM/YYYY" /></div><div className="space-y-3 h-24"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2 h-4"><BubbleGum16Bit className="w-4 h-4"/> Bubble Gum</label><div className="flex bg-slate-950 p-1 rounded-2xl border border-slate-800 h-[58px]">{[0, 1, 2].map(n => (<button type="button" key={n} onClick={() => setFormData({...formData, gumUsed: n})} className={`flex-1 rounded-xl text-sm font-black transition-all ${formData.gumUsed === n ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}>{n}</button>))}</div></div></div>
                    <div className="grid grid-cols-2 gap-6 mb-8"><div className="space-y-3"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest h-4 font-bold">เวลาที่ใช้ (นาที)</label><input type="number" value={formData.minutesUsed} onChange={e => setFormData({...formData, minutesUsed: Number(e.target.value)})} className="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-white font-bold outline-none" /></div><div className="space-y-3"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest h-4 font-bold">ยอดขาย (Zeny)</label><input type="number" value={formData.trashAmount} onChange={e => setFormData({...formData, trashAmount: e.target.value})} className="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-white font-bold outline-none" placeholder="0" /></div></div>
                    <div className="space-y-8 mb-8 border-t border-slate-800 pt-8">
                        <div className="space-y-3"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2 h-4 font-bold"><CoagulatedSpell16Bit className="w-4 h-4"/> Coagulated Spell</label><div className="flex gap-4 h-[58px]"><div className="relative flex-1"><input type="number" value={formData.purpleStoneCount} onChange={e => setFormData({...formData, purpleStoneCount: e.target.value})} className="w-full h-full bg-slate-950 border border-slate-800 rounded-2xl p-4 pr-12 text-white font-bold outline-none" placeholder="0" /><span className="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-slate-500 uppercase tracking-widest pointer-events-none">ชิ้น</span></div><div className="flex bg-slate-950 p-1 rounded-2xl border border-slate-800 w-40 shrink-0"><button type="button" onClick={() => setFormData({...formData, isSellingSpell: true})} className={`flex-1 rounded-xl text-[10px] font-black uppercase transition-all ${formData.isSellingSpell ? 'bg-rose-600 text-white shadow-lg' : 'text-slate-600 hover:text-slate-400'}`}>Sell</button><button type="button" onClick={() => setFormData({...formData, isSellingSpell: false})} className={`flex-1 rounded-xl text-[10px] font-black uppercase transition-all ${!formData.isSellingSpell ? 'bg-green-600 text-white shadow-lg' : 'text-slate-600 hover:text-slate-400'}`}>Store</button></div></div></div>
                        {activeTab === 'aogh' && (<div className="space-y-3 animate-in fade-in"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2 h-4 font-bold"><ContaminatedMagic16Bit className="w-4 h-4"/> Contaminated Magic</label><div className="flex gap-4 h-[58px]"><div className="relative flex-1"><input type="number" value={formData.contMagicCount} onChange={e => setFormData({...formData, contMagicCount: e.target.value})} className="w-full h-full bg-slate-950 border border-slate-800 rounded-2xl p-4 pr-12 text-white font-bold outline-none border-red-500/30 focus:border-red-500" placeholder="0" /><span className="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-slate-500 uppercase tracking-widest pointer-events-none">ชิ้น</span></div><div className="flex bg-slate-950 p-1 rounded-2xl border border-slate-800 w-40 shrink-0"><button type="button" onClick={() => setFormData({...formData, isSellingMagic: true})} className={`flex-1 rounded-xl text-[10px] font-black uppercase transition-all ${formData.isSellingMagic ? 'bg-rose-600 text-white shadow-lg' : 'text-slate-600 hover:text-slate-400'}`}>Sell</button><button type="button" onClick={() => setFormData({...formData, isSellingMagic: false})} className={`flex-1 rounded-xl text-[10px] font-black uppercase transition-all ${!formData.isSellingMagic ? 'bg-green-600 text-white shadow-lg' : 'text-slate-600 hover:text-slate-400'}`}>Store</button></div></div></div>)}
                    </div>
                    <div className="md:col-span-2 space-y-4 border-t border-slate-800 pt-8"><div className="flex justify-between items-center"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2"><Icon name="plus" size={14}/> ต้นทุนเพิ่มเติม</label><button type="button" onClick={addOtherCostField} className="text-[9px] font-black px-4 py-1.5 rounded-lg border border-blue-500/30 bg-blue-500/10 text-blue-500 hover:bg-blue-500/20 transition-all">+ เพิ่มรายการ</button></div>{formData.otherCosts.map((cost, idx) => (<div key={idx} className="flex gap-3 animate-fade-in"><input type="text" value={cost.name} onChange={(e) => updateOtherCost(idx, 'name', e.target.value)} className="flex-[2] bg-slate-950 border border-slate-800 rounded-xl p-3 text-white text-xs font-bold outline-none" placeholder="ชื่อรายการ..." /><div className="flex-1 relative"><input type="number" value={cost.amount} onChange={(e) => updateOtherCost(idx, 'amount', e.target.value)} className="w-full bg-slate-950 border border-slate-800 rounded-xl p-3 pr-8 text-white text-xs font-bold outline-none text-right" /><span className="absolute right-3 top-1/2 -translate-y-1/2 text-[8px] font-black text-slate-600 uppercase tracking-tighter">Z</span></div><button type="button" onClick={() => removeOtherCostField(idx)} className="text-red-500 p-2 hover:bg-red-500/10 rounded-xl transition-all"><Icon name="minus-circle" size={18}/></button></div>))}</div>
                    <div className="space-y-3 pt-8"><label className="text-[10px] font-black text-slate-500 uppercase tracking-widest h-4">บันทึกเพิ่มเติม</label><textarea value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} className="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-white text-sm outline-none font-medium h-24 mt-2 transition-all focus:border-purple-500/50" placeholder="Memo..."></textarea></div>
                    <div className="mt-10 pt-8 border-t border-slate-800 flex gap-4"><button type="button" onClick={() => setIsAdding(false)} className="flex-1 bg-slate-800 py-5 rounded-2xl font-black uppercase tracking-widest transition-all hover:bg-slate-700">ยกเลิก</button><button type="submit" className="flex-[2] bg-gradient-to-r from-purple-600 to-pink-600 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-2xl transition-all active:scale-95">บันทึกข้อมูล</button></div>
                </form>
            );

            // --- MAIN RETURN ---
            if (!user && !isGuestMode && records.length === 0 && !isAdding) return <WelcomeScreen onLogin={handleLogin} onGuest={()=>setIsGuestMode(true)} />;

            return (
                <div className="min-h-screen p-4 md:p-6 lg:p-8 pb-32 max-w-7xl mx-auto safe-area-pb animate-fade-in">
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <div>
                            <div className="flex flex-wrap items-center gap-2 md:gap-4"><h1 className="text-3xl font-black tracking-tight bg-gradient-to-r from-purple-400 via-purple-500 to-pink-500 bg-clip-text text-transparent uppercase italic">Old Glast Heim</h1>
                                <div className="flex gap-2">
                                    <a href="https://www.youtube.com/@SDekza-RO" target="_blank" className="yt-card-horizontal"><div className="yt-avatar"></div><div className="yt-info"><h2 className="yt-name">SDekza RO</h2><div className="yt-stats">140+ Subs</div></div><div className="yt-btn"><SVGs.Google /> Subscribe</div></a>
                                    {!user && <button onClick={() => setShowManual(true)} className="inline-flex items-center gap-2 text-[10px] font-black text-blue-400 bg-blue-500/10 px-3 py-1.5 rounded-2xl border border-blue-500/20 transition-all"><Icon name="help-circle" size={14}/><span>ติดตั้งแอป</span></button>}
                                </div>
                            </div>
                            <p className="text-slate-500 text-[10px] uppercase tracking-[0.4em] font-black mt-2">{user ? "Cloud Dashboard" : "Offline Dashboard"}</p>
                        </div>
                        <div className="flex items-center gap-4 w-full md:w-auto justify-between md:justify-end">
                             {user ? (<div className="flex items-center gap-3 bg-slate-900 p-1 pr-4 rounded-2xl border border-slate-800 shadow-sm"><img src={user.photoURL || "https://via.placeholder.com/32"} className="w-8 h-8 rounded-xl" /><div className="flex flex-col"><span className="text-[10px] font-black text-white truncate max-w-[100px]">{user.displayName}</span><button onClick={handleLogout} className="text-[8px] font-bold text-red-500 uppercase text-left">Logout</button></div></div>) : (<div className="flex gap-2">{isGuestMode && <button onClick={handleExitGuest} className="text-[10px] text-red-500 font-bold px-3 border border-red-500/30 rounded-xl hover:bg-red-500/10 transition-colors">Exit Guest</button>}<button onClick={handleLogin} className="btn-google text-[10px] py-2 px-4 shadow-none border-slate-800 bg-slate-900 text-slate-100 hover:bg-slate-800 transition-colors"><SVGs.Google /> Login</button></div>)}
                             <button onClick={() => { setIsAdding(!isAdding); if(isAdding) setEditingId(null); }} className="flex-1 md:flex-none bg-purple-600 hover:bg-purple-700 transition-all px-6 py-3 rounded-2xl font-black flex items-center justify-center gap-3 shadow-lg active:scale-95 uppercase tracking-widest text-xs"><Icon name={isAdding ? "layout-dashboard" : "plus-circle"} /> {isAdding ? "หน้าหลัก" : "บันทึก"}</button>
                        </div>
                    </div>
                    
                    <div className="flex justify-center mb-8 animate-fade-in"><div className="bg-slate-900/50 p-1 rounded-2xl border border-slate-800 flex gap-2"><button onClick={() => setActiveTab('ogh')} className={`px-6 py-2 rounded-xl text-xs font-black uppercase transition-all ${activeTab === 'ogh' ? 'bg-purple-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}>Normal (OGH)</button><button onClick={() => setActiveTab('aogh')} className={`px-6 py-2 rounded-xl text-xs font-black uppercase transition-all ${activeTab === 'aogh' ? 'bg-red-600 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}>Hard (AOGH)</button></div></div>

                    {!isAdding ? (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
                            <div className="lg:col-span-2 space-y-8">
                                {renderStats()}
                                {records.length > 0 ? renderDashboard() : renderEmptyState()}
                            </div>
                            <div className="space-y-6">
                                {renderSidebar()}
                            </div>
                        </div>
                    ) : (
                        renderForm()
                    )}

                    {showManual && (<div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm" onClick={()=>setShowManual(false)}><div className="bg-slate-900 border border-slate-800 w-full max-w-md p-8 rounded-[2rem] shadow-2xl relative" onClick={e=>e.stopPropagation()}><button onClick={()=>setShowManual(false)} className="absolute top-6 right-6 text-slate-500 hover:text-white"><Icon name="x"/></button><h3 className="text-xl font-black mb-6 text-purple-400 italic uppercase">วิธีติดตั้ง</h3><div className="space-y-4 text-sm text-slate-300"><p>1. <b>iOS:</b> Safari > แชร์ > Add to Home Screen</p><p>2. <b>Android:</b> Chrome > เมนู > Install App</p></div><button onClick={()=>setShowManual(false)} className="w-full mt-8 bg-slate-800 py-3 rounded-xl font-bold uppercase text-xs">ตกลง</button></div></div>)}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

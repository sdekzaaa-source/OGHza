<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquarius Diadem Gacha Simulator</title>
    <!-- ‡πÇ‡∏´‡∏•‡∏î Tailwind CSS ‡∏ú‡πà‡∏≤‡∏ô CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞ Custom CSS */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700;800&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #05020a;
            color: #e2e8f0;
        }
        .georgia-font {
            font-family: 'Georgia', serif;
        }
        /* Custom Scrollbar ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏Å‡∏° Sci-fi */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }
        
        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏ß‡∏á‡πÄ‡∏ß‡∏ó (Magic Circle) */
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }
        @keyframes spin-slow-reverse { 100% { transform: rotate(-360deg); } }
        .magic-circle { animation: spin-slow 20s linear infinite; }
        .magic-circle-reverse { animation: spin-slow-reverse 15s linear infinite; }

        /* ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô Pop-up ‡πÑ‡∏≠‡πÄ‡∏ó‡∏° */
        @keyframes popUp {
            0% { transform: scale(0.5) translateY(20px); opacity: 0; }
            70% { transform: scale(1.1) translateY(-5px); opacity: 1; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .animate-pop-up {
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πå‡∏î SSR ‡∏£‡∏∞‡∏î‡∏±‡∏ö Premium */
        .shimmer {
            background: linear-gradient(120deg, transparent 20%, rgba(255,255,255,0.8) 40%, rgba(255,255,255,0.8) 60%, transparent 80%);
            background-size: 200% 100%;
            animation: shimmer 2.5s infinite linear;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        .ssr-glow {
            box-shadow: 0 0 25px rgba(250, 204, 21, 0.6), inset 0 0 15px rgba(250, 204, 21, 0.4);
        }
        .text-glow {
            text-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body class="relative min-h-screen overflow-x-hidden selection:bg-indigo-500/30">

    <!-- ‡∏ò‡∏µ‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏ß‡∏Å‡∏≤‡∏® (Nebula Background) -->
    <div class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-purple-900/40 rounded-full mix-blend-screen filter blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-blue-900/30 rounded-full mix-blend-screen filter blur-[150px]"></div>
        <div class="absolute top-[20%] left-[40%] w-[30%] h-[30%] bg-indigo-600/20 rounded-full mix-blend-screen filter blur-[100px]"></div>
        <svg class="absolute inset-0 w-full h-full opacity-40" id="stars-container"></svg>
    </div>

    <!-- ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏™‡∏á‡∏£‡∏∞‡∏¢‡∏¥‡∏ö‡∏£‡∏∞‡∏¢‡∏±‡∏ö (SSR Sparkle) -->
    <div id="sparkle-overlay" class="fixed inset-0 pointer-events-none z-[999] hidden items-center justify-center">
        <div class="absolute inset-0 bg-yellow-500/10 animate-pulse"></div>
        <svg class="text-yellow-300 w-40 h-40 animate-ping absolute drop-shadow-[0_0_20px_rgba(253,224,71,0.8)]" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
    </div>

    <!-- Top HUD (‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô) -->
    <div class="fixed top-0 left-0 w-full p-4 md:px-8 md:py-6 flex justify-between items-center z-50 pointer-events-none">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-slate-800 border border-slate-600 flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <div class="hidden md:block text-slate-300 font-bold tracking-wider">GACHA SYSTEM</div>
        </div>
        <!-- Currency Bar (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î) -->
        <div class="pointer-events-auto flex items-center gap-2 bg-slate-900/80 border border-slate-700 rounded-full pl-4 pr-2 py-1.5 backdrop-blur-md shadow-[0_0_15px_rgba(0,0,0,0.5)]">
            <span class="text-xs text-slate-400 font-medium uppercase tracking-wider">Total Pulls</span>
            <span id="total-pulls-text" class="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-300 w-12 text-right">0</span>
            <div class="w-8 h-8 rounded-full bg-indigo-500/20 border border-indigo-400/50 flex items-center justify-center ml-2">
                <svg class="w-4 h-4 text-indigo-300" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            </div>
        </div>
    </div>

    <!-- Overlay ‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏ä‡∏≤‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á -->
    <div id="pull-overlay" class="fixed inset-0 bg-black/85 z-[100] hidden flex-col items-center justify-start md:justify-center pt-24 pb-10 px-4 md:p-12 backdrop-blur-md transition-opacity duration-300 overflow-y-auto" onclick="handleOverlayClick(event)">
        
        <h2 id="overlay-skip-text" class="text-slate-400 font-medium text-sm animate-pulse tracking-widest uppercase select-none cursor-pointer mb-2 text-center">Tap anywhere to skip</h2>
        
        <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô -->
        <h3 id="overlay-pull-count-text" class="text-fuchsia-400 font-black text-xl md:text-2xl mb-6 hidden text-center drop-shadow-[0_0_10px_rgba(192,38,211,0.6)] transition-all"></h3>
        
        <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏° -->
        <div id="overlay-items-container" class="grid grid-cols-3 sm:grid-cols-5 gap-3 md:gap-5 max-w-5xl w-full justify-center content-center pb-8">
            <!-- Items ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏° Action (‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö) -->
        <div id="overlay-actions" class="hidden flex-col items-center gap-6 mt-10 pb-10">
            <div class="flex flex-wrap justify-center gap-3 md:gap-4">
                <button onclick="pull(1, true)" class="group relative overflow-hidden rounded-full bg-slate-800/80 border border-slate-500 text-white px-6 py-3 md:py-3.5 font-bold shadow-[0_0_20px_rgba(0,0,0,0.5)] transform active:scale-95 transition-all flex items-center gap-2">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-indigo-600/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative z-10 text-xs md:text-sm">PULL x1</span>
                </button>
                <button onclick="pull(10, true)" class="group relative overflow-hidden rounded-full bg-gradient-to-b from-yellow-500 to-amber-700 border border-yellow-300 text-amber-950 px-6 py-3 md:py-3.5 font-black shadow-[0_0_30px_rgba(245,158,11,0.4)] transform active:scale-95 transition-all flex items-center gap-2">
                    <div class="absolute inset-0 bg-gradient-to-r from-yellow-300/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative z-10 drop-shadow-sm text-xs md:text-sm">PULL x10</span>
                </button>
                <button onclick="pullUntilSSR(true)" class="group relative overflow-hidden rounded-full bg-gradient-to-r from-fuchsia-600 to-purple-700 border border-fuchsia-400 text-white px-6 py-3 md:py-3.5 font-black shadow-[0_0_20px_rgba(192,38,211,0.4)] transform active:scale-95 transition-all flex items-center gap-2">
                    <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative z-10 drop-shadow-sm text-xs md:text-sm tracking-wider">UNTIL SSR</span>
                </button>
            </div>
            <div class="text-slate-400 font-medium text-sm select-none cursor-pointer hover:text-white transition-colors bg-white/10 px-6 py-2 rounded-full border border-white/20 backdrop-blur-md">‡πÅ‡∏ï‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</div>
        </div>
    </div>

    <!-- Main Layout (Split Desktop / Stacked Mobile) -->
    <div class="relative z-10 max-w-[1400px] mx-auto min-h-screen flex flex-col lg:flex-row pt-20 pb-10 lg:pt-0 lg:pb-0">
        
        <!-- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡πÅ‡∏ó‡πà‡∏ô‡∏Å‡∏≤‡∏ä‡∏≤ (Gacha Stage) -->
        <div class="w-full lg:w-5/12 lg:h-screen flex flex-col items-center justify-center p-6 relative">
            
            <div class="text-center mb-8 relative z-20">
                <h1 class="text-5xl md:text-7xl font-black mb-2 drop-shadow-[0_5px_5px_rgba(0,0,0,0.8)] georgia-font leading-tight">
                    <span class="bg-gradient-to-b from-yellow-100 via-yellow-400 to-amber-600 bg-clip-text text-transparent block">AQUARIUS</span>
                    <span class="bg-gradient-to-b from-blue-100 via-blue-400 to-indigo-600 bg-clip-text text-transparent block">DIADEM</span>
                </h1>
                <p class="text-indigo-200/80 font-bold tracking-[0.3em] uppercase text-xs md:text-sm drop-shadow-md">Scroll Simulator</p>
            </div>

            <div id="egg-container" class="relative flex items-center justify-center w-full max-w-[320px] aspect-square transition-all duration-300 group">
                <!-- ‡∏ß‡∏á‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå (Magic Circles) ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á -->
                <div class="absolute inset-0 flex items-center justify-center opacity-40 mix-blend-screen pointer-events-none">
                    <svg class="w-full h-full magic-circle text-blue-500" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="0.5">
                        <circle cx="50" cy="50" r="48" stroke-dasharray="4 4"/>
                        <circle cx="50" cy="50" r="40"/>
                        <polygon points="50,10 85,75 15,75" />
                        <polygon points="50,90 15,25 85,25" />
                    </svg>
                </div>
                <div class="absolute inset-0 flex items-center justify-center opacity-20 mix-blend-screen pointer-events-none">
                    <svg class="w-[80%] h-[80%] magic-circle-reverse text-indigo-400" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="0.5">
                        <circle cx="50" cy="50" r="45"/>
                        <rect x="18" y="18" width="64" height="64" transform="rotate(45 50 50)" />
                    </svg>
                </div>

                <!-- ‡∏≠‡∏≠‡∏£‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÑ‡∏Ç‡πà -->
                <div id="egg-glow" class="absolute w-48 h-48 bg-blue-500 rounded-full blur-[60px] opacity-30 group-hover:opacity-50 transition-opacity"></div>
                <img id="egg-img" src="images/egg.png" alt="Aquarius Egg" class="relative z-10 w-[70%] object-contain drop-shadow-[0_0_30px_rgba(59,130,246,0.4)] transition-transform duration-500 group-hover:scale-105 group-hover:drop-shadow-[0_0_40px_rgba(99,102,241,0.6)]" />
            </div>

            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏™‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å -->
            <div class="flex flex-col gap-3 mt-10 relative z-20 w-full max-w-sm px-4">
                <div class="flex gap-3">
                    <button id="btn-pull-1" onclick="pull(1)" class="flex-1 relative overflow-hidden rounded-xl bg-slate-800/80 border border-slate-600/50 text-white py-4 font-bold shadow-[0_4px_20px_rgba(0,0,0,0.4)] transform active:scale-95 transition-all disabled:opacity-50 group backdrop-blur-sm">
                        <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <span class="relative z-10 flex flex-col items-center">
                            <span class="text-xs text-slate-400 font-normal uppercase tracking-wider mb-1">Summon</span>
                            <span class="text-lg">x1</span>
                        </span>
                    </button>
                    <button id="btn-pull-10" onclick="pull(10)" class="flex-1 relative overflow-hidden rounded-xl bg-gradient-to-b from-yellow-500 to-amber-600 border border-yellow-400/80 text-amber-950 py-4 font-black shadow-[0_4px_30px_rgba(217,119,6,0.3)] transform active:scale-95 transition-all disabled:opacity-50 group">
                        <div class="absolute inset-0 bg-gradient-to-b from-yellow-300/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <span class="relative z-10 flex flex-col items-center">
                            <span class="text-xs text-amber-900/70 font-bold uppercase tracking-wider mb-1">Summon</span>
                            <span class="text-lg drop-shadow-sm">x10</span>
                        </span>
                    </button>
                </div>
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR -->
                <button id="btn-pull-until-ssr" onclick="pullUntilSSR()" class="w-full relative overflow-hidden rounded-xl bg-gradient-to-r from-fuchsia-600 to-purple-700 border border-fuchsia-400/80 text-white py-3 font-black shadow-[0_4px_20px_rgba(192,38,211,0.4)] transform active:scale-95 transition-all disabled:opacity-50 group">
                    <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <span class="relative z-10 flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="m17 7-5-5-5 5"/><path d="m17 17-5 5-5-5"/></svg>
                        <span class="text-sm md:text-base drop-shadow-sm uppercase tracking-wider">‡∏™‡∏∏‡πà‡∏°‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR</span>
                    </span>
                </button>
            </div>
        </div>

        <!-- ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Dashboard - Inventory & Stats) -->
        <div class="w-full lg:w-7/12 lg:h-screen lg:overflow-y-auto p-4 md:p-8 flex flex-col gap-6">
            
            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á Inventory -->
            <div class="glass-panel rounded-3xl p-6 relative overflow-hidden">
                <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                    <h3 class="text-lg md:text-xl font-bold flex items-center gap-2 text-white">
                        <svg class="text-indigo-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                        INVENTORY <span class="text-xs font-normal text-slate-400 ml-2 tracking-widest hidden md:inline">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</span>
                    </h3>
                    <button onclick="resetData()" class="px-4 py-2 text-xs font-bold uppercase tracking-wider text-red-400 hover:text-red-300 bg-red-950/30 hover:bg-red-900/40 border border-red-900/50 rounded-lg flex items-center gap-2 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                        Clear
                    </button>
                </div>
                
                <div id="empty-inventory-state" class="h-40 flex flex-col items-center justify-center text-slate-500 font-medium bg-slate-900/30 rounded-2xl border border-dashed border-slate-700/50">
                    <svg class="mb-3 text-slate-600 w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>
                    <span>Tap Summon to start</span>
                </div>
                
                <div id="inventory-section" class="hidden">
                    <div id="inventory-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 max-h-[300px] lg:max-h-none overflow-y-auto pr-2">
                        <!-- Inventory items -->
                    </div>
                </div>
            </div>

            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á Luck Meter & Rates -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏î‡∏ß‡∏á (Luck Meter) -->
                <div id="luck-meter-container" class="glass-panel rounded-3xl p-6 hidden">
                    <h3 class="text-sm font-bold tracking-widest uppercase mb-4 flex items-center gap-2 text-slate-300">
                        <svg class="text-purple-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                        Luck Meter
                    </h3>
                    <div class="text-center bg-slate-900/60 rounded-2xl p-4 border border-slate-700/50 shadow-inner mb-4">
                        <div id="luck-tier-name" class="text-xl font-black mb-1">üëë ‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏Å GM</div>
                        <div id="luck-tier-desc" class="text-xs font-medium text-slate-400">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏ä‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</div>
                    </div>
                    <div class="space-y-3 text-xs font-medium text-slate-300">
                        <div class="flex justify-between items-center bg-slate-800/40 p-2 rounded-lg">
                            <span>Luck Score:</span> <span id="luck-score-text" class="font-black text-sm text-white">120%</span>
                        </div>
                        <div class="flex justify-between items-center px-2">
                            <span>SSR Acquired:</span> <span id="luck-ssr-actual" class="font-bold text-yellow-400">2</span>
                        </div>
                        <div class="flex justify-between items-center px-2 text-slate-500">
                            <span>Expected SSR:</span> <span id="luck-ssr-expected">0.50</span>
                        </div>
                    </div>
                </div>

                <!-- ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏î‡∏£‡∏≠‡∏õ -->
                <div class="glass-panel rounded-3xl p-6">
                    <h3 class="text-sm font-bold tracking-widest uppercase mb-4 flex items-center gap-2 text-slate-300">
                        <svg class="text-blue-400" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                        Drop Rates
                    </h3>
                    <div id="rates-container" class="space-y-3 pr-2">
                        <!-- Rates -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏≠‡πÄ‡∏ó‡∏° 
        const ITEMS = [
            { id: 'ssr1', name: 'Sealed Card Album II', rank: 'SSR', qty: 1, imgSrc: 'images/1.png' },
            { id: 'ssr2', name: 'Sealed Card Album', rank: 'SSR', qty: 1, imgSrc: 'images/2.png' },
            { id: 'ssr3', name: 'Costume Arabian Veil', rank: 'SSR', qty: 1, imgSrc: 'images/3.png' },
            { id: 'ssr4', name: "Rasen Huuma's Orb [1]", rank: 'SSR', qty: 1, imgSrc: 'images/4.png' },
            { id: 'ssr5', name: 'Aquarius Diadem [1]', rank: 'SSR', qty: 1, imgSrc: 'images/5.png' },
            { id: 'sr1', name: 'Aquarius Staff [2]', rank: 'SR', qty: 1, imgSrc: 'images/6.png' },
            { id: 'sr2', name: 'Aquarius Ring [1]', rank: 'SR', qty: 1, imgSrc: 'images/7.png' },
            { id: 'sr3', name: 'Huuma Shuriken Clearness [2]', rank: 'SR', qty: 1, imgSrc: 'images/8.png' },
            { id: 'r1', name: 'Cross Shuriken Shadow Earring', rank: 'R', qty: 1, imgSrc: 'images/9.png' },
            { id: 'r2', name: 'Magic Compose Shadow Armor', rank: 'R', qty: 1, imgSrc: 'images/10.png' },
            { id: 'r3', name: 'Blitz Shadow Pendant', rank: 'R', qty: 1, imgSrc: 'images/11.png' },
            { id: 'r4', name: 'Blitz Shadow Earring', rank: 'R', qty: 1, imgSrc: 'images/12.png' },
            { id: 'r5', name: 'Status Shadow Item Combiner', rank: 'R', qty: 1, imgSrc: 'images/13.png' },
            { id: 'a1', name: 'Blood Twig', rank: 'A', qty: 1, imgSrc: 'images/14.png' },
            { id: 'b1', name: 'Class Shadow Cube', rank: 'B', qty: 1, imgSrc: 'images/15.png' },
            { id: 'b2', name: 'Poison Bottle Box', rank: 'B', qty: 1, imgSrc: 'images/16.png' },
            { id: 'b3', name: '[Scroll] STR Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/17.png' },
            { id: 'b4', name: '[Scroll] AGI Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/18.png' },
            { id: 'b5', name: '[Scroll] INT Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/19.png' },
            { id: 'b6', name: '[Scroll] VIT Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/20.png' },
            { id: 'b7', name: '[Scroll] DEX Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/21.png' },
            { id: 'b8', name: '[Scroll] LUK Biscuit Stick', rank: 'B', qty: 2, imgSrc: 'images/22.png' },
            { id: 'c1', name: '[Scroll] Blessing Lv.10 Scroll', rank: 'C', qty: 10, imgSrc: 'images/23.png' },
            { id: 'c2', name: '[Scroll] Increase Agility Lv.10 Scroll', rank: 'C', qty: 10, imgSrc: 'images/24.png' },
            { id: 'e1', name: '[Scroll] Ex Def Potion', rank: 'E', qty: 5, imgSrc: 'images/25.png' },
            { id: 'e2', name: '[Scroll] Kafra Card', rank: 'E', qty: 5, imgSrc: 'images/26.png' },
        ];

        // ‡πÄ‡∏£‡∏ó‡∏≠‡∏≠‡∏£‡∏¥‡∏à‡∏¥‡∏ô‡∏±‡∏•
        const RATES = { SSR: 0.5, SR: 2.5, R: 12.0, A: 15.0, B: 30.0, C: 20.0, E: 20.0 };

        const RANK_STYLES = {
            'SSR': { bg: 'bg-gradient-to-br from-yellow-100 via-yellow-200 to-amber-200 ssr-glow', border: 'border-yellow-400', text: 'text-amber-900 font-extrabold', grad: 'from-amber-400 to-yellow-600' },
            'SR': { bg: 'bg-purple-100', border: 'border-purple-300', text: 'text-purple-900 font-bold', grad: 'from-purple-400 to-purple-600' },
            'R': { bg: 'bg-blue-100', border: 'border-blue-300', text: 'text-blue-900 font-bold', grad: 'from-blue-400 to-blue-600' },
            'A': { bg: 'bg-emerald-100', border: 'border-emerald-300', text: 'text-emerald-900 font-bold', grad: 'from-emerald-400 to-emerald-600' },
            'B': { bg: 'bg-lime-100', border: 'border-lime-300', text: 'text-lime-900 font-bold', grad: 'from-lime-400 to-lime-600' },
            'C': { bg: 'bg-white', border: 'border-slate-300', text: 'text-slate-800 font-bold', grad: 'from-slate-300 to-slate-400' },
            'E': { bg: 'bg-slate-200', border: 'border-slate-400', text: 'text-slate-700 font-bold', grad: 'from-slate-400 to-slate-500' }
        };

        const RANK_POINTS = { 'SSR': 500, 'SR': 100, 'R': 20, 'A': 15, 'B': 5, 'C': 2, 'E': 1 };
        const EXPECTED_SCORE_PER_PULL = 11.75;

        // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏≠‡∏õ
        let history = [];
        let totalPulls = 0;
        let isSpinning = false;
        
        // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Animation (‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞ Loop)
        let currentAnimationInterval = null;
        let currentPullsToAnimate = [];
        let isOverlayAnimating = false;
        
        // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR)
        let isAutoPulling = false;
        let autoPullCount = 0;

        // Background Stars
        function renderStars() {
            const container = document.getElementById('stars-container');
            let starsHTML = '';
            for(let i=0; i<60; i++) {
                const cx = Math.random() * 100;
                const cy = Math.random() * 100;
                const r = Math.random() * 1.5 + 0.5;
                const opacity = Math.random() * 0.8 + 0.2;
                starsHTML += `<circle cx="${cx}%" cy="${cy}%" r="${r}" fill="#cbd5e1" opacity="${opacity}" />`;
            }
            container.innerHTML = starsHTML;
        }

        function renderRates() {
            const container = document.getElementById('rates-container');
            let html = '';
            for (const [rank, rate] of Object.entries(RATES)) {
                const style = RANK_STYLES[rank];
                html += `
                    <div class="flex justify-between items-center text-xs font-medium">
                        <span class="w-8 font-black text-transparent bg-clip-text bg-gradient-to-b ${style.grad}">${rank}</span>
                        <div class="flex-1 mx-3 h-1.5 bg-slate-800 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r ${style.grad}" style="width: ${rate}%"></div>
                        </div>
                        <span class="text-slate-400 w-10 text-right">${rate}%</span>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Inventory
        function renderInventory() {
            const section = document.getElementById('inventory-section');
            const container = document.getElementById('inventory-container');
            const emptyState = document.getElementById('empty-inventory-state');
            
            if (history.length === 0) {
                section.classList.add('hidden');
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                return;
            }
            
            section.classList.remove('hidden');
            emptyState.classList.add('hidden');
            emptyState.classList.remove('flex');

            const inventory = {};
            history.forEach(item => {
                if (inventory[item.id]) { inventory[item.id].totalCount += item.qty; } 
                else { inventory[item.id] = { ...item, totalCount: item.qty }; }
            });

            const rankOrder = { 'SSR': 1, 'SR': 2, 'R': 3, 'A': 4, 'B': 5, 'C': 6, 'E': 7 };
            const sortedItems = Object.values(inventory).sort((a, b) => rankOrder[a.rank] - rankOrder[b.rank]);

            let html = '';
            sortedItems.forEach(item => {
                const style = RANK_STYLES[item.rank];
                
                let bgEffect = '';
                if (item.rank === 'SSR') {
                    bgEffect = `
                        <div class="absolute inset-0 shimmer mix-blend-overlay pointer-events-none rounded-xl"></div>
                        <div class="absolute top-1 left-2 text-[10px] animate-ping pointer-events-none">‚ú®</div>
                        <div class="absolute bottom-6 right-2 text-[10px] animate-pulse pointer-events-none">‚ú®</div>
                    `;
                }

                html += `
                    <div class="${style.bg} border-2 ${style.border} p-1.5 md:p-2 rounded-xl text-center flex flex-col items-center justify-between min-h-[100px] md:min-h-[120px] relative overflow-hidden shadow-sm">
                        ${bgEffect}
                        <div class="absolute top-1 right-1 text-[9px] font-black px-1.5 py-0.5 rounded-md text-white bg-slate-900/80 shadow border border-slate-600 z-20">
                            x${item.totalCount.toLocaleString()}
                        </div>
                        <img src="${item.imgSrc}" alt="${item.name}" class="w-10 h-10 md:w-14 md:h-14 mt-4 z-10 object-contain drop-shadow-sm mix-blend-multiply" />
                        <div class="z-10 w-full mt-1 md:mt-2 pb-1 relative">
                            <p class="text-[9px] md:text-[10px] leading-tight line-clamp-2 ${style.text}">${item.name}</p>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Luck Calculator
        function updateLuckMeter() {
            const container = document.getElementById('luck-meter-container');
            if (totalPulls === 0) {
                container.classList.add('hidden');
                return;
            }
            container.classList.remove('hidden');

            let totalPoints = 0;
            let ssrCount = 0;
            history.forEach(item => {
                totalPoints += RANK_POINTS[item.rank] || 0;
                if (item.rank === 'SSR') ssrCount++;
            });

            const avgPoints = totalPoints / totalPulls;
            const luckRatio = avgPoints / EXPECTED_SCORE_PER_PULL;
            const luckPercent = (luckRatio * 100).toFixed(0);

            let tierName, tierDesc, tierColor;
            if (luckRatio >= 2.0) { tierName = 'üëë ‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏Å GM'; tierDesc = '‡∏î‡∏ß‡∏á‡πÄ‡∏ó‡∏û‡∏ó‡∏£‡∏π ‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏ä‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!'; tierColor = 'text-purple-400 text-glow'; } 
            else if (luckRatio >= 1.2) { tierName = '‚ú® ‡∏î‡∏ß‡∏á‡∏î‡∏µ'; tierDesc = '‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏´‡πá‡∏ô‡πÜ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏ß‡∏á‡∏°‡∏≤!'; tierColor = 'text-blue-400 text-glow'; } 
            else if (luckRatio >= 0.8) { tierName = 'üòê ‡∏õ‡∏Å‡∏ï‡∏¥'; tierDesc = '‡πÄ‡∏£‡∏ó‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö'; tierColor = 'text-green-400'; } 
            else if (luckRatio >= 0.5) { tierName = 'üßÇ ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠'; tierDesc = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÑ‡∏ï‡∏û‡∏±‡∏á'; tierColor = 'text-orange-400'; } 
            else { tierName = 'üíÄ ‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏î‡∏î‡∏ã‡∏µ'; tierDesc = '‡πÄ‡∏Ñ‡πá‡∏°‡∏õ‡∏µ‡πã! ‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô...'; tierColor = 'text-red-500 text-glow'; }

            const expectedSSR = (totalPulls * 0.005).toFixed(2);

            document.getElementById('luck-tier-name').innerText = tierName;
            document.getElementById('luck-tier-name').className = `text-xl font-black mb-1 ${tierColor}`;
            document.getElementById('luck-tier-desc').innerText = tierDesc;
            document.getElementById('luck-score-text').innerText = `${luckPercent}%`;
            document.getElementById('luck-ssr-actual').innerText = ssrCount.toLocaleString();
            document.getElementById('luck-ssr-expected').innerText = expectedSSR;
        }

        // ==========================================
        // Overlay Animation Logic
        // ==========================================
        function createOverlayItemHTML(item) {
            const style = RANK_STYLES[item.rank];
            let bgEffect = '';
            if (item.rank === 'SSR') {
                bgEffect = `
                    <div class="absolute inset-0 shimmer mix-blend-overlay pointer-events-none rounded-xl"></div>
                    <div class="absolute top-2 left-3 text-lg animate-ping pointer-events-none drop-shadow-[0_0_5px_yellow]">‚ú®</div>
                    <div class="absolute bottom-10 right-3 text-lg animate-pulse pointer-events-none drop-shadow-[0_0_5px_yellow]">‚ú®</div>
                `;
            }
            const qtyText = item.qty > 1 ? `<p class="text-[9px] md:text-[10px] text-white font-bold bg-slate-900/60 border border-slate-600 px-2 py-0.5 rounded-full inline-block mt-1 z-20 relative">${item.qty} ea</p>` : '';

            return `
                <div class="${style.bg} border-2 ${style.border} p-2 md:p-3 rounded-xl md:rounded-2xl text-center flex flex-col items-center justify-between min-h-[110px] md:min-h-[160px] relative overflow-hidden group animate-pop-up shadow-xl">
                    ${bgEffect}
                    <img src="${item.imgSrc}" alt="${item.name}" class="w-12 h-12 md:w-20 md:h-20 mt-2 md:mt-4 z-10 object-contain drop-shadow-sm mix-blend-multiply" />
                    <div class="z-10 w-full mt-2 pb-1 relative">
                        <p class="text-[9px] md:text-sm leading-tight line-clamp-2 ${style.text}">${item.name}</p>
                        ${qtyText}
                    </div>
                </div>
            `;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏° 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ 
        function generateRandomItem() {
            const rand = Math.random() * 100;
            let cumulative = 0;
            let selectedRank = 'E';

            for (const [rank, rate] of Object.entries(RATES)) {
                cumulative += rate;
                if (rand <= cumulative) { selectedRank = rank; break; }
            }
            const possibleItems = ITEMS.filter(item => item.rank === selectedRank);
            return possibleItems[Math.floor(Math.random() * possibleItems.length)];
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pull x1 ‡∏´‡∏£‡∏∑‡∏≠ x10 
        function startPullAnimation(pulls) {
            currentPullsToAnimate = pulls;
            isOverlayAnimating = true;

            const overlay = document.getElementById('pull-overlay');
            const container = document.getElementById('overlay-items-container');
            const actions = document.getElementById('overlay-actions');
            const skipText = document.getElementById('overlay-skip-text');

            container.innerHTML = '';
            actions.classList.add('hidden');
            skipText.classList.remove('hidden');
            
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');

            let index = 0;
            if (currentAnimationInterval) clearInterval(currentAnimationInterval);

            container.insertAdjacentHTML('beforeend', createOverlayItemHTML(pulls[index]));
            index++;

            if (index >= pulls.length) {
                setTimeout(endAnimation, 300);
            } else {
                currentAnimationInterval = setInterval(() => {
                    if (index >= pulls.length) {
                        endAnimation();
                        return;
                    }
                    container.insertAdjacentHTML('beforeend', createOverlayItemHTML(pulls[index]));
                    overlay.scrollTo({ top: overlay.scrollHeight, behavior: 'smooth' });
                    index++;
                }, 200);
            }
        }

        function endAnimation() {
            isOverlayAnimating = false;
            clearInterval(currentAnimationInterval);
            document.getElementById('overlay-actions').classList.remove('hidden');
            document.getElementById('overlay-actions').classList.add('flex');
            document.getElementById('overlay-skip-text').classList.add('hidden');
            
            const hasSSR = (isAutoPulling) ? true : currentPullsToAnimate.some(p => p.rank === 'SSR');
            if (hasSSR) {
                const sparkle = document.getElementById('sparkle-overlay');
                sparkle.classList.remove('hidden');
                sparkle.classList.add('flex');
                setTimeout(() => {
                    sparkle.classList.add('hidden');
                    sparkle.classList.remove('flex');
                }, 1500);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏ö‡∏Å‡∏≤‡∏£ Pull‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR)
        function finishAutoPull(gotSSR) {
            clearInterval(currentAnimationInterval);
            isSpinning = false;
            isOverlayAnimating = false;
            isAutoPulling = false;

            document.getElementById('total-pulls-text').innerText = totalPulls.toLocaleString();
            renderInventory();
            updateLuckMeter();

            const countTextObj = document.getElementById('overlay-pull-count-text');
            countTextObj.innerHTML = `üéâ ‡∏≠‡∏≠‡∏Å SSR ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà <span class="text-white text-3xl ml-1 mr-1">${autoPullCount}</span>`;
            
            document.getElementById('overlay-actions').classList.remove('hidden');
            document.getElementById('overlay-actions').classList.add('flex');
            document.getElementById('overlay-skip-text').classList.add('hidden');

            if (gotSSR) {
                const sparkle = document.getElementById('sparkle-overlay');
                sparkle.classList.remove('hidden');
                sparkle.classList.add('flex');
                setTimeout(() => {
                    sparkle.classList.add('hidden');
                    sparkle.classList.remove('flex');
                }, 1500);
            }
        }

        // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠ Skip
        function handleOverlayClick(e) {
            if (e.target.closest('button')) return;

            const overlay = document.getElementById('pull-overlay');
            const container = document.getElementById('overlay-items-container');

            if (isAutoPulling) {
                // ‡∏´‡∏≤‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏£‡∏±‡∏ß‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Skip -> ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ß‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR
                clearInterval(currentAnimationInterval);
                
                let gotSSR = false;
                let lastItem = null;

                while (!gotSSR && autoPullCount < 5000) {
                    autoPullCount++;
                    const selectedItem = generateRandomItem();
                    lastItem = { ...selectedItem, timestamp: Date.now() + autoPullCount };
                    
                    history.push(lastItem);
                    totalPulls++;

                    if (lastItem.rank === 'SSR') {
                        gotSSR = true;
                        // ‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πå‡∏î SSR ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏£‡∏±‡∏ô‡∏≠‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡πâ‡∏à‡∏ö
                        container.insertAdjacentHTML('beforeend', createOverlayItemHTML(lastItem));
                        if (container.children.length > 20) {
                            container.removeChild(container.firstChild);
                        }
                        overlay.scrollTo({ top: overlay.scrollHeight, behavior: 'smooth' });
                    }
                }
                finishAutoPull(gotSSR);

            } else if (isOverlayAnimating) {
                // ‡∏´‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ (1 ‡∏´‡∏£‡∏∑‡∏≠ 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Skip
                clearInterval(currentAnimationInterval);
                for (let i = container.children.length; i < currentPullsToAnimate.length; i++) {
                    container.insertAdjacentHTML('beforeend', createOverlayItemHTML(currentPullsToAnimate[i]));
                }
                overlay.scrollTo({ top: overlay.scrollHeight, behavior: 'smooth' });
                endAnimation();
            } else {
                closeOverlay();
            }
        }

        function closeOverlay() {
            const overlay = document.getElementById('pull-overlay');
            overlay.classList.add('hidden');
            overlay.classList.remove('flex');
        }

        // ==========================================
        // Main Action Functions
        // ==========================================
        
        // ‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (1 ‡∏´‡∏£‡∏∑‡∏≠ 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
        function pull(count, fromOverlay = false) {
            if (isSpinning) return;
            isSpinning = true;

            document.getElementById('overlay-pull-count-text').classList.add('hidden');

            if (!fromOverlay) {
                document.getElementById('btn-pull-1').disabled = true;
                document.getElementById('btn-pull-10').disabled = true;
                document.getElementById('btn-pull-until-ssr').disabled = true;
                document.getElementById('egg-container').classList.add('scale-105');
                document.getElementById('egg-img').classList.add('animate-bounce');
            } else {
                document.getElementById('overlay-actions').classList.add('hidden');
                document.getElementById('overlay-actions').classList.remove('flex');
                document.getElementById('overlay-skip-text').classList.remove('hidden');
                document.getElementById('overlay-items-container').innerHTML = '';
            }

            const newPulls = [];
            for (let i = 0; i < count; i++) {
                const selectedItem = generateRandomItem();
                newPulls.push({ ...selectedItem, timestamp: Date.now() + i });
            }

            const delay = fromOverlay ? 50 : 600;

            setTimeout(() => {
                history = [...newPulls, ...history];
                totalPulls += count;
                isSpinning = false;

                if (!fromOverlay) {
                    document.getElementById('btn-pull-1').disabled = false;
                    document.getElementById('btn-pull-10').disabled = false;
                    document.getElementById('btn-pull-until-ssr').disabled = false;
                    document.getElementById('egg-container').classList.remove('scale-105');
                    document.getElementById('egg-img').classList.remove('animate-bounce');
                }

                document.getElementById('total-pulls-text').innerText = totalPulls.toLocaleString();
                renderInventory();
                updateLuckMeter();

                startPullAnimation(newPulls);
            }, delay);
        }

        // ‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ß‡πÜ ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ SSR
        function pullUntilSSR(fromOverlay = false) {
            if (isSpinning) return;
            isSpinning = true;
            isOverlayAnimating = true;
            isAutoPulling = true;
            autoPullCount = 0;

            const overlay = document.getElementById('pull-overlay');
            const container = document.getElementById('overlay-items-container');
            const actions = document.getElementById('overlay-actions');
            const skipText = document.getElementById('overlay-skip-text');
            const countTextObj = document.getElementById('overlay-pull-count-text');

            if (!fromOverlay) {
                document.getElementById('btn-pull-1').disabled = true;
                document.getElementById('btn-pull-10').disabled = true;
                document.getElementById('btn-pull-until-ssr').disabled = true;
                document.getElementById('egg-container').classList.add('scale-105');
                document.getElementById('egg-img').classList.add('animate-bounce');
            }

            actions.classList.add('hidden');
            actions.classList.remove('flex');
            skipText.classList.remove('hidden');
            
            countTextObj.classList.remove('hidden');
            countTextObj.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°... <span class="text-white text-3xl ml-1 mr-1">0</span>`;
            container.innerHTML = '';

            overlay.classList.remove('hidden');
            overlay.classList.add('flex');

            const delay = fromOverlay ? 50 : 600;

            setTimeout(() => {
                if (!fromOverlay) {
                    document.getElementById('btn-pull-1').disabled = false;
                    document.getElementById('btn-pull-10').disabled = false;
                    document.getElementById('btn-pull-until-ssr').disabled = false;
                    document.getElementById('egg-container').classList.remove('scale-105');
                    document.getElementById('egg-img').classList.remove('animate-bounce');
                }

                // ‡∏™‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ß‡πÜ ‡∏ó‡∏µ‡∏•‡∏∞ 0.15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                currentAnimationInterval = setInterval(() => {
                    autoPullCount++;
                    const selectedItem = generateRandomItem();
                    const newItem = { ...selectedItem, timestamp: Date.now() };

                    history.push(newItem);
                    totalPulls++;
                    
                    container.insertAdjacentHTML('beforeend', createOverlayItemHTML(newItem));
                    
                    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡∏î ‡∏´‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 20 ‡πÉ‡∏ö ‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏•‡∏ö‡πÉ‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ó‡∏¥‡πâ‡∏á ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô
                    if (container.children.length > 20) {
                        container.removeChild(container.firstChild);
                    }
                    
                    // Auto-scroll ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≠‡∏•‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    overlay.scrollTo({ top: overlay.scrollHeight, behavior: 'smooth' });

                    countTextObj.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°... <span class="text-white text-3xl ml-1 mr-1">${autoPullCount}</span>`;

                    // ‡∏´‡∏≤‡∏Å‡πÑ‡∏î‡πâ SSR ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
                    if (newItem.rank === 'SSR' || autoPullCount >= 5000) {
                        finishAutoPull(newItem.rank === 'SSR');
                    }
                }, 150); 
                
            }, delay);
        }

        function resetData() {
            history = [];
            totalPulls = 0;
            document.getElementById('total-pulls-text').innerText = '0';
            renderInventory();
            updateLuckMeter();
        }

        window.onload = () => {
            renderStars();
            renderRates();
            renderInventory();
            updateLuckMeter();
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CNX 2026 Trip Planner</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc;
            overscroll-behavior-y: none;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animation for Dropdown */
        .fade-enter {
            opacity: 0;
            transform: translateY(-10px);
        }
        .fade-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen flex items-center justify-center bg-slate-50 text-slate-400 font-bold safe-top safe-bottom">
        <div class="text-center animate-pulse">Loading CNX Trip...</div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- ICONS ---
        const Icon = ({ children, className, size = 24, onClick }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} onClick={onClick}>{children}</svg>
        );
        const Icons = {
            Plane: (p) => <Icon {...p}><path d="M2 22h20"/><path d="M22 2 2 22"/><path d="M2 2 22 22" opacity="0"/><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.2-1.1.7l-1.2 4 6 3.2-2 2-4-1.5L1 16l7.4 1.6c.7.1 1.4-.1 1.9-.4l4.1-3.2 2.4 4.3c.3.4.7.7 1.1.8l.8.2.1-1.1z"/></Icon>,
            Car: (p) => <Icon {...p}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></Icon>,
            Utensils: (p) => <Icon {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>,
            Coffee: (p) => <Icon {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></Icon>,
            Camera: (p) => <Icon {...p}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>,
            Home: (p) => <Icon {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>,
            MapPin: (p) => <Icon {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>,
            Plus: (p) => <Icon {...p}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>,
            Trash2: (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>,
            Moon: (p) => <Icon {...p}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></Icon>,
            Sun: (p) => <Icon {...p}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></Icon>,
            Leaf: (p) => <Icon {...p}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 6.5-2 11a7 7 0 0 1-6 7z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>,
            Fuel: (p) => <Icon {...p}><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></Icon>,
            Save: (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>,
            Navigation: (p) => <Icon {...p}><polygon points="3 11 22 2 13 21 11 13 3 11"/></Icon>,
            ChevronDown: (p) => <Icon {...p}><path d="m6 9 6 6 6-6"/></Icon>,
            ChevronUp: (p) => <Icon {...p}><path d="m18 15-6-6-6 6"/></Icon>,
            Coins: (p) => <Icon {...p}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></Icon>
        };

        // --- COMPONENTS ---

        // Component สำหรับรายการย่อยในแต่ละวัน (แยกออกมาเพื่อความสะอาดของโค้ด)
        const ItineraryItem = ({ item, dayIndex, itemIndex, onToggle, onAddExpense, onDeleteExpense }) => {
            const [expenseNote, setExpenseNote] = useState('');
            const [expenseAmount, setExpenseAmount] = useState('');

            const handleAdd = () => {
                if (expenseNote && expenseAmount) {
                    onAddExpense(dayIndex, itemIndex, expenseNote, parseFloat(expenseAmount));
                    setExpenseNote('');
                    setExpenseAmount('');
                }
            };

            const totalItemCost = item.expenses ? item.expenses.reduce((sum, ex) => sum + ex.amount, 0) : 0;

            return (
                <div className="relative group">
                     {/* Timeline Dot */}
                    <div className="absolute -left-[41px] top-2 w-4 h-4 rounded-full border-4 border-[#F4EBE1] bg-[#4A4238] z-10"></div>
                    
                    {/* Card */}
                    <div className={`bg-[#FFF9F3] border border-[#DED0B6] rounded-2xl transition-all overflow-hidden ${item.isOpen ? 'shadow-md ring-1 ring-[#DED0B6]' : 'hover:scale-[1.01]'}`}>
                        
                        {/* Header (Click to Toggle) */}
                        <div className="p-4 cursor-pointer" onClick={() => onToggle(dayIndex, itemIndex)}>
                            <div className="flex justify-between items-start mb-2">
                                <span className="text-[10px] font-black opacity-40 uppercase tracking-tighter bg-black/5 px-2 py-0.5 rounded text-blue-600">
                                    {item.time}
                                </span>
                                <div className="flex gap-2">
                                    {totalItemCost > 0 && (
                                        <span className="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-0.5 rounded-full flex items-center gap-1">
                                            ฿{totalItemCost.toLocaleString()}
                                        </span>
                                    )}
                                    {item.isOpen ? <Icons.ChevronUp size={16} className="opacity-40"/> : <Icons.ChevronDown size={16} className="opacity-40"/>}
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <div className="mt-1 opacity-80">{item.icon}</div>
                                <div>
                                    <h3 className="font-bold leading-tight text-[#4A4238]">{item.activity}</h3>
                                    <p className="text-xs opacity-60 mt-0.5">{item.location}</p>
                                </div>
                            </div>
                        </div>

                        {/* Dropdown Details */}
                        {item.isOpen && (
                            <div className="bg-white/50 border-t border-[#DED0B6]/30 p-4 animate-in slide-in-from-top-2 duration-200">
                                
                                {/* Links/Actions */}
                                {item.link && (
                                    <a href={item.link} target="_blank" className="flex items-center gap-2 text-xs font-bold text-blue-600 mb-4 bg-blue-50 p-2 rounded-lg w-fit">
                                        <Icons.Navigation size={14}/> นำทางด้วย Google Maps
                                    </a>
                                )}

                                {/* Expenses Section */}
                                <div className="space-y-3">
                                    <p className="text-xs font-bold uppercase opacity-40 flex items-center gap-1">
                                        <Icons.Coins size={12}/> บันทึกค่าใช้จ่ายจุดนี้
                                    </p>
                                    
                                    {/* List Expenses */}
                                    {item.expenses && item.expenses.length > 0 && (
                                        <ul className="space-y-1 mb-2">
                                            {item.expenses.map((ex, idx) => (
                                                <li key={idx} className="flex justify-between text-sm items-center group/ex">
                                                    <span className="opacity-80">- {ex.note}</span>
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-mono font-bold">฿{ex.amount.toLocaleString()}</span>
                                                        <button onClick={() => onDeleteExpense(dayIndex, itemIndex, idx)} className="opacity-20 hover:opacity-100 hover:text-red-500"><Icons.Trash2 size={12}/></button>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    )}

                                    {/* Add Expense Form */}
                                    <div className="flex gap-2">
                                        <input 
                                            type="text" 
                                            placeholder="รายการ" 
                                            className="flex-1 p-2 rounded-lg bg-white border border-[#DED0B6] text-sm outline-none focus:ring-1 focus:ring-blue-400"
                                            value={expenseNote}
                                            onChange={e => setExpenseNote(e.target.value)}
                                        />
                                        <input 
                                            type="number" 
                                            placeholder="บาท" 
                                            className="w-20 p-2 rounded-lg bg-white border border-[#DED0B6] text-sm text-right outline-none focus:ring-1 focus:ring-blue-400"
                                            value={expenseAmount}
                                            onChange={e => setExpenseAmount(e.target.value)}
                                        />
                                        <button onClick={handleAdd} className="bg-blue-500 text-white p-2 rounded-lg shadow-sm active:scale-95">
                                            <Icons.Plus size={16}/>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };


        // --- MAIN APP ---
        const App = () => {
            const [theme, setTheme] = useState('muji');
            
            // Initial Data Structure with Expenses array
            const [itineraryData, setItineraryData] = useState([
                {
                    date: '4 Feb 2026',
                    title: 'Day 1: มุ่งสู่ม่อนแจ่ม',
                    items: [
                        { time: '11:10', activity: 'ถึงสนามบินเชียงใหม่ (CNX)', iconType: 'Plane', iconColor: 'text-blue-500', location: 'Terminal 1', link: 'https://maps.google.com/?q=Chiang+Mai+International+Airport', isOpen: false, expenses: [] },
                        { time: '11:45', activity: 'รับรถเช่าที่จองไว้', iconType: 'Car', iconColor: 'text-slate-500', location: 'Counter Car Rental', link: '', isOpen: false, expenses: [{note: 'มัดจำรถ', amount: 3000}] },
                        { time: '12:15', activity: 'ทานมื้อเที่ยง (เน้นเร็ว)', iconType: 'Utensils', iconColor: 'text-orange-500', location: 'ร้านอาหารใกล้สนามบิน', link: 'https://maps.google.com/?q=Restaurants+near+CNX', isOpen: false, expenses: [] },
                        { time: '13:30', activity: 'Cafe Hopping (แม่ริม)', iconType: 'Coffee', iconColor: 'text-yellow-700', location: 'Chic 39 / WTF Coffee Camp', link: 'https://maps.google.com/?q=Chic+39+Chiang+Mai', isOpen: false, expenses: [] },
                        { time: '15:00', activity: 'เช็คอินที่พัก', iconType: 'Home', iconColor: 'text-green-600', location: 'ม่อนลมหนาว โฮมสเตย์', link: 'https://maps.google.com/?q=ม่อนลมหนาว+โฮมสเตย์', isOpen: false, expenses: [] },
                        { time: '16:30', activity: 'ชมวิวพระอาทิตย์ตก', iconType: 'Camera', iconColor: 'text-purple-500', location: 'ยิ่งยงสวนดอกไม้', link: 'https://maps.google.com/?q=ยิ่งยงสวนดอกไม้', isOpen: false, expenses: [] },
                        { time: '18:30', activity: 'มื้อค่ำ: หมูกระทะ', iconType: 'Utensils', iconColor: 'text-red-500', location: 'หน้าห้องพัก (ม่อนลมหนาว)', link: '', isOpen: false, expenses: [] },
                    ]
                }
            ]);

            const [gasTotal, setGasTotal] = useState(0);
            const [showGasInput, setShowGasInput] = useState(false);
            const [tempGas, setTempGas] = useState('');
            const [flightCost, setFlightCost] = useState(0);
            const [isEditingFlight, setIsEditingFlight] = useState(false);

            // Helpers to render icons dynamically
            const renderIcon = (type, color) => {
                const IconComp = Icons[type] || Icons.MapPin;
                return <IconComp className={color} />;
            };

            // Handlers
            const handleToggleItem = (dayIdx, itemIdx) => {
                const newData = [...itineraryData];
                newData[dayIdx].items[itemIdx].isOpen = !newData[dayIdx].items[itemIdx].isOpen;
                setItineraryData(newData);
            };

            const handleAddExpense = (dayIdx, itemIdx, note, amount) => {
                const newData = [...itineraryData];
                newData[dayIdx].items[itemIdx].expenses.push({ note, amount });
                setItineraryData(newData);
            };

            const handleDeleteExpense = (dayIdx, itemIdx, expenseIdx) => {
                const newData = [...itineraryData];
                newData[dayIdx].items[itemIdx].expenses.splice(expenseIdx, 1);
                setItineraryData(newData);
            };

            const handleAddGas = () => {
                if (tempGas && !isNaN(tempGas)) {
                    setGasTotal(prev => prev + parseFloat(tempGas));
                    setTempGas('');
                    setShowGasInput(false);
                }
            };

            // Calculations
            const totalActivityExpenses = useMemo(() => {
                let sum = 0;
                itineraryData.forEach(day => {
                    day.items.forEach(item => {
                        if(item.expenses) {
                            item.expenses.forEach(ex => sum += ex.amount);
                        }
                    });
                });
                return sum;
            }, [itineraryData]);

            const grandTotal = gasTotal + flightCost + totalActivityExpenses;

            return (
                <div className="min-h-[100dvh] bg-[#F4EBE1] text-[#4A4238] font-sans pb-32">
                    {/* Header */}
                    <div className="max-w-md mx-auto p-6 pt-2 flex justify-between items-center sticky top-0 z-20 backdrop-blur-md bg-[#F4EBE1]/90 safe-top">
                        <div>
                            <h1 className="text-2xl font-black tracking-tight">CNX 2026</h1>
                            <p className="text-xs font-bold opacity-50 uppercase tracking-widest">Version Pro</p>
                        </div>
                        <div className="flex bg-white/40 p-1 rounded-full border border-white/50">
                            <button className="p-2 rounded-full bg-[#DED0B6] text-[#4A4238] shadow"><Icons.Leaf size={16}/></button>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto px-6 space-y-6">
                        
                        {/* Alert */}
                        <div className="bg-orange-500 text-white p-4 rounded-3xl shadow-lg shadow-orange-500/20 flex items-center gap-4">
                            <div className="bg-white/20 p-2 rounded-2xl">
                                <Icons.Plane className="animate-pulse" size={24} />
                            </div>
                            <div className="text-sm">
                                <p className="font-bold">Flight Recovery</p>
                                <p className="opacity-90">เริ่มใหม่ 11:10 น.</p>
                            </div>
                        </div>

                        {/* Itinerary List */}
                        <div className="space-y-8">
                            {itineraryData.map((day, dayIdx) => (
                                <div key={dayIdx} className="space-y-4">
                                    <div className="flex items-center justify-between sticky top-20 z-10 py-2 bg-[#F4EBE1]/95 backdrop-blur">
                                        <h2 className="text-xl font-black flex items-center gap-2 text-[#4A4238]">
                                            <Icons.MapPin size={22} className="text-red-500"/> {day.title}
                                        </h2>
                                        <span className="text-xs font-bold px-3 py-1 bg-black/5 rounded-full opacity-60">{day.date}</span>
                                    </div>
                                    
                                    <div className="relative ml-4 space-y-4 border-l-2 border-dashed border-[#DED0B6] pl-8 pb-2">
                                        {day.items.map((item, itemIdx) => (
                                            <ItineraryItem 
                                                key={itemIdx}
                                                item={{...item, icon: renderIcon(item.iconType, item.iconColor)}}
                                                dayIndex={dayIdx}
                                                itemIndex={itemIdx}
                                                onToggle={handleToggleItem}
                                                onAddExpense={handleAddExpense}
                                                onDeleteExpense={handleDeleteExpense}
                                            />
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Summary Widget */}
                        <div className="bg-[#FFF9F3] border border-[#DED0B6] p-6 rounded-[2.5rem] shadow-xl relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full -mr-16 -mt-16"></div>
                            <h3 className="font-black text-lg mb-4 flex items-center gap-2">
                                สรุปค่าใช้จ่ายทั้งหมด
                            </h3>
                            
                            <div className="space-y-3">
                                {/* Flight */}
                                <div className="flex justify-between items-center text-sm p-3 bg-red-500/5 rounded-2xl text-red-600 border border-red-500/10">
                                    <span className="flex items-center gap-2 font-bold"><Icons.Plane size={16}/> ตั๋วเครื่องบิน</span>
                                    {isEditingFlight ? (
                                        <input 
                                            type="number" className="w-20 p-1 bg-transparent border-b border-red-500 text-right font-mono outline-none"
                                            onChange={(e) => setFlightCost(parseFloat(e.target.value) || 0)}
                                            onBlur={() => setIsEditingFlight(false)} autoFocus
                                        />
                                    ) : (
                                        <span onClick={() => setIsEditingFlight(true)} className="font-mono font-bold">฿{flightCost.toLocaleString()}</span>
                                    )}
                                </div>
                                
                                {/* Gas */}
                                <div className="flex justify-between items-center text-sm p-3 bg-blue-500/5 rounded-2xl text-blue-600 border border-blue-500/10">
                                    <span className="flex items-center gap-2 font-bold"><Icons.Fuel size={16}/> ค่าน้ำมันรวม</span>
                                    {!showGasInput ? (
                                        <div className="flex items-center gap-2" onClick={() => setShowGasInput(true)}>
                                            <span className="font-mono font-bold">฿{gasTotal.toLocaleString()}</span>
                                            <Icons.Plus size={14} className="opacity-50"/>
                                        </div>
                                    ) : (
                                        <div className="flex gap-1">
                                            <input type="number" className="w-16 p-1 bg-white border rounded text-right text-xs" autoFocus
                                                onChange={e => setTempGas(e.target.value)} placeholder="0"
                                            />
                                            <button onClick={handleAddGas} className="bg-blue-500 text-white rounded px-2"><Icons.Save size={12}/></button>
                                        </div>
                                    )}
                                </div>

                                {/* Activity Expenses */}
                                <div className="flex justify-between items-center text-sm p-3 bg-green-500/5 rounded-2xl text-green-700 border border-green-500/10">
                                    <span className="flex items-center gap-2 font-bold"><Icons.Coins size={16}/> ค่ากิน/เที่ยว/อื่นๆ</span>
                                    <span className="font-mono font-bold">฿{totalActivityExpenses.toLocaleString()}</span>
                                </div>
                            </div>

                            <div className="mt-6 pt-4 border-t border-black/5 flex justify-between items-end">
                                <div>
                                    <p className="text-[10px] font-bold opacity-40 uppercase">Grand Total</p>
                                    <p className="text-2xl font-black text-[#4A4238]">฿{grandTotal.toLocaleString()}</p>
                                </div>
                                <div className="text-[10px] bg-green-500 text-white px-3 py-1 rounded-full font-bold uppercase animate-pulse">
                                    Live
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>



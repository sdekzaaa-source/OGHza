<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CNX 2026 Trip Planner</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #F4EBE1;
            overscroll-behavior-y: none;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input, textarea { font-family: 'Noto Sans Thai', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- ICONS (SVG) ---
        const Icon = ({ children, className, size = 24, onClick, style }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} onClick={onClick} style={style}>{children}</svg>
        );
        
        const Icons = {
            Plane: (p) => <Icon {...p}><path d="M2 22h20"/><path d="M22 2 2 22"/><path d="M2 2 22 22" opacity="0"/><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.2-1.1.7l-1.2 4 6 3.2-2 2-4-1.5L1 16l7.4 1.6c.7.1 1.4-.1 1.9-.4l4.1-3.2 2.4 4.3c.3.4.7.7 1.1.8l.8.2.1-1.1z"/></Icon>,
            Car: (p) => <Icon {...p}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></Icon>,
            Utensils: (p) => <Icon {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></Icon>,
            Coffee: (p) => <Icon {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></Icon>,
            Camera: (p) => <Icon {...p}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></Icon>,
            Home: (p) => <Icon {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>,
            MapPin: (p) => <Icon {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>,
            Plus: (p) => <Icon {...p}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>,
            Trash2: (p) => <Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>,
            Leaf: (p) => <Icon {...p}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 6.5-2 11a7 7 0 0 1-6 7z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>,
            Fuel: (p) => <Icon {...p}><line x1="3" x2="15" y1="22" y2="22"/><line x1="4" x2="14" y1="9" y2="9"/><path d="M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18"/><path d="M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5"/></Icon>,
            Save: (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>,
            Navigation: (p) => <Icon {...p}><polygon points="3 11 22 2 13 21 11 13 3 11"/></Icon>,
            ChevronDown: (p) => <Icon {...p}><path d="m6 9 6 6 6-6"/></Icon>,
            ChevronRight: (p) => <Icon {...p}><path d="m9 18 6-6-6-6"/></Icon>,
            Coins: (p) => <Icon {...p}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></Icon>,
            Edit: (p) => <Icon {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></Icon>,
            Wallet: (p) => <Icon {...p}><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></Icon>,
            Map: (p) => <Icon {...p}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></Icon>,
            X: (p) => <Icon {...p}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></Icon>,
            Compass: (p) => <Icon {...p}><circle cx="12" cy="12" r="10"/><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/></Icon>,
            BookOpen: (p) => <Icon {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>,
            Image: (p) => <Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></Icon>,
            CheckSquare: (p) => <Icon {...p}><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></Icon>,
            Square: (p) => <Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/></Icon>,
            Settings: (p) => <Icon {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>,
            Share: (p) => <Icon {...p}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></Icon>,
            Copy: (p) => <Icon {...p}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></Icon>
        };

        const INITIAL_ITINERARY = [
            {
                dateShort: '4 ‡∏Å.‡∏û.',
                title: 'Day 1: ‡∏Ç‡∏∏‡∏ô‡πÄ‡∏Ç‡∏≤‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°',
                items: [
                    { time: '11:10', activity: '‡∏ñ‡∏∂‡∏á‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà', iconType: 'Plane', iconColor: 'text-blue-500', location: '‡πÅ‡∏•‡∏ô‡∏î‡∏¥‡πâ‡∏á & ‡∏£‡∏±‡∏ö‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤', link: 'https://maps.google.com/?q=Chiang+Mai+International+Airport', isOpen: false, completed: false, expenses: [], journalMood: '', journalNote: '', journalImage: null },
                    { time: '12:30', activity: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á: ‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°', iconType: 'Utensils', iconColor: 'text-orange-500', location: '‡∏™‡πâ‡∏°‡∏ï‡∏≥‡∏≠‡∏∏‡∏î‡∏£ / ‡∏´‡∏•‡∏á‡∏õ‡πà‡∏≤', link: 'https://maps.google.com/?q=Somtum+Udon+Maerim', isOpen: false, completed: false, expenses: [] },
                    { time: '14:00', activity: 'Pongyang Jungle Coaster', iconType: 'Camera', iconColor: 'text-green-600', location: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πâ & ‡∏Å‡∏≤‡πÅ‡∏ü', link: 'https://maps.google.com/?q=Pongyang+Jungle+Coaster', isOpen: false, completed: false, expenses: [] },
                    { time: '16:00', activity: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ‡∏°‡πà‡∏≠‡∏ô‡∏•‡∏°‡∏´‡∏ô‡∏≤‡∏ß', iconType: 'Home', iconColor: 'text-indigo-500', location: '‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏° (‡∏ä‡∏°‡∏ß‡∏¥‡∏ß‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á)', link: 'https://maps.google.com/?q=Mon+Lom+Nao+Homestay', isOpen: false, completed: false, expenses: [] },
                    { time: '18:30', activity: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô: ‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞', iconType: 'Utensils', iconColor: 'text-red-500', location: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å (‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤)', link: '', isOpen: false, completed: false, expenses: [] }
                ]
            },
            {
                dateShort: '5 ‡∏Å.‡∏û.',
                title: 'Day 2: ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏° & ‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á',
                items: [
                    { time: '09:30', activity: 'Skywalk ‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏°', iconType: 'Camera', iconColor: 'text-blue-400', location: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡∏ß‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ', link: 'https://maps.google.com/?q=Mon+Jam+Skywalk', isOpen: false, completed: false, expenses: [] },
                    { time: '11:00', activity: '‡∏ß‡∏±‡∏î‡∏õ‡πà‡∏≤‡∏î‡∏≤‡∏£‡∏≤‡∏†‡∏¥‡∏£‡∏°‡∏¢‡πå', iconType: 'MapPin', iconColor: 'text-yellow-600', location: '‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤', link: 'https://maps.google.com/?q=Wat+Pa+Dara+Phirom', isOpen: false, completed: false, expenses: [] },
                    { time: '12:30', activity: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á: ‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢', iconType: 'Utensils', iconColor: 'text-orange-500', location: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏ã‡∏≠‡∏¢‡πÅ‡∏°‡πà‡∏™‡∏≤‡∏¢ / ‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô', link: 'https://maps.google.com/?q=Khao+Soi+Mae+Sai', isOpen: false, completed: false, expenses: [] },
                    { time: '14:00', activity: 'One Nimman', iconType: 'Camera', iconColor: 'text-red-400', location: '‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á & ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ï‡∏∂‡∏Å‡πÅ‡∏î‡∏á', link: 'https://maps.google.com/?q=One+Nimman', isOpen: false, completed: false, expenses: [] },
                    { time: '16:00', activity: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏° R2', iconType: 'Home', iconColor: 'text-slate-600', location: '‡∏¢‡πà‡∏≤‡∏ô‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô', link: 'https://maps.google.com/?q=R2+Hotel+Chiang+Mai', isOpen: false, completed: false, expenses: [] },
                    { time: '19:30', activity: 'Night Bazaar', iconType: 'Utensils', iconColor: 'text-pink-500', location: 'Ploen Ruedee Market', link: 'https://maps.google.com/?q=Ploen+Ruedee+Night+Market', isOpen: false, completed: false, expenses: [] }
                ]
            },
            {
                dateShort: '6 ‡∏Å.‡∏û.',
                title: 'Day 3: ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏ä‡πâ‡∏≤ & ‡∏°‡∏±‡∏ó‡∏â‡∏∞',
                items: [
                    { time: '09:00', activity: '‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡∏°‡∏≤‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ï (JJ)', iconType: 'Leaf', iconColor: 'text-green-500', location: '‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏≤‡∏ü‡∏ï‡πå & ‡∏Å‡∏≤‡πÅ‡∏ü', link: 'https://maps.google.com/?q=Jing+Jai+Market', isOpen: false, completed: false, expenses: [] },
                    { time: '11:30', activity: 'Chom Cafe', iconType: 'Camera', iconColor: 'text-green-700', location: '‡∏™‡∏ß‡∏ô‡∏õ‡πà‡∏≤‡∏´‡∏¥‡∏°‡∏û‡∏≤‡∏ô‡∏ï‡πå', link: 'https://maps.google.com/?q=Chom+Cafe+and+Restaurant', isOpen: false, completed: false, expenses: [] },
                    { time: '13:30', activity: 'Magokoro Teahouse', iconType: 'Coffee', iconColor: 'text-green-800', location: '‡∏°‡∏±‡∏ó‡∏â‡∏∞‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡πÅ‡∏ó‡πâ', link: 'https://maps.google.com/?q=Magokoro+Teahouse', isOpen: false, completed: false, expenses: [] },
                    { time: '15:30', activity: '‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ù‡∏≤‡∏Å: ‡∏ß‡∏ô‡∏±‡∏™‡∏ô‡∏±‡∏ô‡∏ó‡πå', iconType: 'Coins', iconColor: 'text-yellow-500', location: '‡πÑ‡∏™‡πâ‡∏≠‡∏±‡πà‡∏ß / ‡∏ô‡πâ‡∏≥‡∏û‡∏£‡∏¥‡∏Å‡∏´‡∏ô‡∏∏‡πà‡∏°', link: 'https://maps.google.com/?q=Vanasnun', isOpen: false, completed: false, expenses: [] },
                    { time: '16:30', activity: '‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ & ‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô', iconType: 'Plane', iconColor: 'text-blue-500', location: '‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ñ‡∏±‡∏á', link: 'https://maps.google.com/?q=Chiang+Mai+International+Airport', isOpen: false, completed: false, expenses: [] }
                ]
            }
        ];

        const ItineraryItem = ({ item, dayIndex, itemIndex, onToggle, onAddExpense, onDeleteExpense, onUpdateItem, onDeleteItem, onToggleDone }) => {
            const [expenseNote, setExpenseNote] = useState('');
            const [expenseAmount, setExpenseAmount] = useState('');
            const [isEditing, setIsEditing] = useState(item.isNew || false);
            
            const [editTime, setEditTime] = useState(item.time);
            const [editActivity, setEditActivity] = useState(item.activity);
            const [editLocation, setEditLocation] = useState(item.location);
            const [editLink, setEditLink] = useState(item.link || '');

            const handleMoodChange = (mood) => onUpdateItem(dayIndex, itemIndex, { journalMood: mood });
            const handleNoteChange = (e) => onUpdateItem(dayIndex, itemIndex, { journalNote: e.target.value });
            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => onUpdateItem(dayIndex, itemIndex, { journalImage: reader.result });
                    reader.readAsDataURL(file);
                }
            };
            const handleAddExpenseLocal = (e) => {
                e.stopPropagation();
                if (expenseNote && expenseAmount) {
                    onAddExpense(dayIndex, itemIndex, expenseNote, parseFloat(expenseAmount));
                    setExpenseNote('');
                    setExpenseAmount('');
                }
            };
            const handleSaveEdit = (e) => {
                e.stopPropagation();
                onUpdateItem(dayIndex, itemIndex, {
                    time: editTime, activity: editActivity, location: editLocation, link: editLink, isNew: false
                });
                setIsEditing(false);
            };
            const handleDeleteItemLocal = (e) => {
                e.stopPropagation();
                if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) onDeleteItem(dayIndex, itemIndex);
            };
            const handleDoneClick = (e) => {
                e.stopPropagation();
                onToggleDone(dayIndex, itemIndex);
            };

            const totalItemCost = item.expenses ? item.expenses.reduce((sum, ex) => sum + ex.amount, 0) : 0;
            const moods = ['üòç', 'üòä', 'üòê', 'üòï', 'üò¥'];

            if (isEditing) {
                return (
                    <div className="relative pl-6 mb-4">
                         <div className="absolute left-0 top-6 w-4 h-4 -ml-[9px] rounded-full border-4 border-blue-200 bg-blue-500 z-10"></div>
                         <div className="bg-white border border-blue-200 rounded-2xl shadow-md p-4 space-y-3">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-blue-500 uppercase">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                                <button onClick={(e) => { e.stopPropagation(); if(item.isNew) onDeleteItem(dayIndex, itemIndex); else setIsEditing(false); }} className="text-gray-400"><Icons.X size={16}/></button>
                            </div>
                            <div className="grid grid-cols-3 gap-2">
                                <div className="col-span-1">
                                    <label className="text-[10px] font-bold opacity-50 block mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label>
                                    <input type="text" value={editTime} onChange={e => setEditTime(e.target.value)} className="w-full p-2 bg-gray-50 rounded border text-sm font-bold" placeholder="12:00" />
                                </div>
                                <div className="col-span-2">
                                    <label className="text-[10px] font-bold opacity-50 block mb-1">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
                                    <input type="text" value={editActivity} onChange={e => setEditActivity(e.target.value)} className="w-full p-2 bg-gray-50 rounded border text-sm font-bold" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°..." />
                                </div>
                            </div>
                            <div>
                                <label className="text-[10px] font-bold opacity-50 block mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="text" value={editLocation} onChange={e => setEditLocation(e.target.value)} className="w-full p-2 bg-gray-50 rounded border text-sm" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà..." />
                            </div>
                            <div>
                                <label className="text-[10px] font-bold opacity-50 block mb-1">Link ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="text" value={editLink} onChange={e => setEditLink(e.target.value)} className="w-full p-2 bg-gray-50 rounded border text-sm" placeholder="https://..." />
                            </div>
                            <div className="pt-2 flex gap-2">
                                <button onClick={handleSaveEdit} className="flex-1 bg-blue-500 text-white py-2 rounded-xl font-bold text-sm shadow-md active:scale-95">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            </div>
                         </div>
                    </div>
                );
            }

            return (
                <div className="relative pl-6">
                    <div className={`absolute left-0 top-6 w-4 h-4 -ml-[9px] rounded-full border-4 z-10 transition-colors ${item.completed ? 'border-green-200 bg-green-500' : 'border-[#F4EBE1] bg-[#4A4238]'}`}></div>
                    
                    <div className={`bg-[#FFF9F3] border rounded-2xl transition-all duration-300 overflow-hidden mb-4 ${item.isOpen ? 'shadow-lg ring-1 ring-[#DED0B6]' : 'shadow-sm active:scale-[0.99]'} ${item.completed ? 'opacity-60 border-green-200' : 'border-[#DED0B6]'}`}>
                        <div className="p-4 cursor-pointer select-none" onClick={() => onToggle(dayIndex, itemIndex)}>
                            <div className="flex justify-between items-start mb-2">
                                <div className="flex items-center gap-2">
                                    <div onClick={handleDoneClick} className={`p-1 rounded hover:bg-black/5 transition-colors ${item.completed ? 'text-green-500' : 'text-gray-300'}`}>
                                        {item.completed ? <Icons.CheckSquare size={18}/> : <Icons.Square size={18}/>}
                                    </div>
                                    <span className={`text-[10px] font-black uppercase tracking-tighter px-2 py-0.5 rounded ${item.completed ? 'bg-green-100 text-green-700 decoration-slice line-through' : 'bg-black/5 text-blue-600'}`}>{item.time}</span>
                                </div>
                                <div className="flex gap-2 items-center">
                                    {item.journalMood && <span className="text-lg">{item.journalMood}</span>}
                                    {totalItemCost > 0 && <span className="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-0.5 rounded-full">‡∏ø{totalItemCost.toLocaleString()}</span>}
                                    <div className={`transition-transform duration-300 opacity-40 ${item.isOpen ? 'rotate-180' : ''}`}><Icons.ChevronDown size={16} /></div>
                                </div>
                            </div>
                            <div className="flex items-start gap-3">
                                <div className={`mt-1 min-w-[24px] ${item.completed ? 'opacity-40 grayscale' : 'opacity-80'}`}>{item.icon}</div>
                                <div>
                                    <h3 className={`font-bold leading-tight text-[#4A4238] text-base transition-all ${item.completed ? 'line-through opacity-50' : ''}`}>{item.activity}</h3>
                                    <p className="text-xs opacity-60 mt-1">{item.location}</p>
                                </div>
                            </div>
                        </div>
                        
                        {item.isOpen && (
                            <div className="bg-white/50 border-t border-[#DED0B6]/30 p-4 animate-in slide-in-from-top-1 fade-in duration-200">
                                <div className="flex justify-end gap-2 mb-4">
                                    <button onClick={(e) => { e.stopPropagation(); setIsEditing(true); }} className="flex items-center gap-1 text-[10px] bg-white border border-gray-200 px-2 py-1 rounded shadow-sm text-gray-600 hover:text-blue-500"><Icons.Edit size={12}/> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                    <button onClick={handleDeleteItemLocal} className="flex items-center gap-1 text-[10px] bg-white border border-gray-200 px-2 py-1 rounded shadow-sm text-gray-600 hover:text-red-500"><Icons.Trash2 size={12}/> ‡∏•‡∏ö</button>
                                </div>

                                <div className="mb-4 bg-yellow-50/50 p-3 rounded-xl border border-yellow-200/30">
                                    <p className="text-xs font-bold uppercase opacity-40 flex items-center gap-1 mb-2"><Icons.BookOpen size={12}/> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥</p>
                                    <div className="flex gap-2 mb-3 overflow-x-auto pb-1">
                                        {moods.map(m => (
                                            <button key={m} onClick={() => handleMoodChange(m)} className={`text-2xl p-1 rounded-lg transition-transform hover:scale-125 ${item.journalMood === m ? 'bg-yellow-200 scale-110 shadow-sm' : 'opacity-50 grayscale hover:grayscale-0'}`}>{m}</button>
                                        ))}
                                    </div>
                                    <textarea placeholder="‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..." value={item.journalNote || ''} onChange={handleNoteChange} className="w-full p-2 bg-white rounded-lg border border-yellow-200/50 text-sm mb-2 min-h-[60px] outline-none focus:ring-1 focus:ring-yellow-400" />
                                    <div className="flex items-center gap-3">
                                        <label className="flex items-center gap-2 bg-white border border-dashed border-gray-300 text-gray-500 px-3 py-2 rounded-lg text-xs cursor-pointer hover:bg-gray-50 hover:border-blue-400 hover:text-blue-500 transition-colors">
                                            <Icons.Image size={16}/> {item.journalImage ? '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'} <input type="file" accept="image/*" className="hidden" onChange={handleImageChange} />
                                        </label>
                                        {item.journalImage && <span className="text-[10px] text-green-500 flex items-center gap-1">‚úì ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß</span>}
                                    </div>
                                    {item.journalImage && <div className="mt-2 rounded-lg overflow-hidden border border-gray-200"><img src={item.journalImage} className="w-full h-auto object-cover max-h-40" /></div>}
                                </div>

                                {item.link && <a href={item.link} target="_blank" className="inline-flex items-center gap-2 text-xs font-bold text-blue-600 mb-4 bg-blue-50 px-3 py-2 rounded-lg w-full justify-center"><Icons.Navigation size={14}/> ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Google Maps</a>}
                                
                                <div className="space-y-3 bg-white/60 p-3 rounded-xl border border-[#DED0B6]/20">
                                    <p className="text-xs font-bold uppercase opacity-40 flex items-center gap-1 mb-2 border-b border-black/5 pb-1"><Icons.Coins size={12}/> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</p>
                                    {item.expenses && item.expenses.length > 0 && (
                                        <ul className="space-y-2 mb-3">
                                            {item.expenses.map((ex, idx) => (
                                                <li key={idx} className="flex justify-between text-sm items-center bg-white p-2 rounded border border-transparent hover:border-red-100">
                                                    <span className="opacity-80 text-xs">{ex.note}</span>
                                                    <div className="flex items-center gap-3"><span className="font-mono font-bold text-xs">‡∏ø{ex.amount.toLocaleString()}</span><button onClick={(e) => { e.stopPropagation(); onDeleteExpense(dayIndex, itemIndex, idx); }} className="text-red-300 hover:text-red-500"><Icons.Trash2 size={14}/></button></div>
                                                </li>
                                            ))}
                                        </ul>
                                    )}
                                    <div className="flex gap-2 items-center" onClick={(e) => e.stopPropagation()}>
                                        <input type="text" placeholder="‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£..." className="flex-1 p-2 rounded-lg bg-white border border-[#DED0B6] text-sm outline-none focus:ring-1 focus:ring-blue-400 min-w-0" value={expenseNote} onChange={e => setExpenseNote(e.target.value)} />
                                        <input type="number" placeholder="‡∏ö‡∏≤‡∏ó" className="w-16 p-2 rounded-lg bg-white border border-[#DED0B6] text-sm text-right outline-none focus:ring-1 focus:ring-blue-400" value={expenseAmount} onChange={e => setExpenseAmount(e.target.value)} />
                                        <button onClick={handleAddExpenseLocal} className="bg-blue-500 text-white p-2 rounded-lg shadow-sm active:scale-95 shrink-0"><Icons.Plus size={16}/></button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- SHARE MODAL ---
        const ShareModal = ({ isOpen, onClose, journalData }) => {
            if (!isOpen) return null;

            const generateText = () => {
                let text = "‚úàÔ∏è Chiang Mai Trip 2026 ‚õ∞Ô∏è\n\n";
                journalData.forEach(entry => {
                    text += `${entry.dayDate} | ${entry.time}\n`;
                    text += `üìç ${entry.activity} ${entry.journalMood || ''}\n`;
                    if (entry.journalNote) text += `üí¨ "${entry.journalNote}"\n`;
                    text += `\n`;
                });
                text += "#CNX2026 #ChiangMai #Travel";
                return text;
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(generateText());
                alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Facebook ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
            };

            return (
                <div className="fixed inset-0 z-[100] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm">
                    <div className="bg-[#F4EBE1] w-full max-w-sm rounded-[2rem] overflow-hidden max-h-[90vh] flex flex-col">
                        <div className="p-4 bg-white border-b border-[#DED0B6] flex justify-between items-center">
                            <h3 className="font-black text-[#4A4238] flex items-center gap-2"><Icons.Share size={20}/> Share Trip</h3>
                            <button onClick={onClose}><Icons.X size={24} className="opacity-50"/></button>
                        </div>
                        
                        <div className="overflow-y-auto p-4 space-y-6">
                            {/* Option 1: Copy Text */}
                            <div className="bg-white p-4 rounded-2xl shadow-sm space-y-3">
                                <h4 className="font-bold text-sm text-[#4A4238]">1. ‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô (Caption)</h4>
                                <textarea readOnly className="w-full h-32 p-2 text-xs bg-gray-50 rounded-xl border border-gray-200 outline-none resize-none" value={generateText()}></textarea>
                                <button onClick={copyToClipboard} className="w-full py-2 bg-[#4A4238] text-white rounded-xl text-xs font-bold flex items-center justify-center gap-2 active:scale-95"><Icons.Copy size={14}/> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>

                            {/* Option 2: Screenshot Area */}
                            <div>
                                <h4 className="font-bold text-sm text-[#4A4238] mb-2">2. ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ (Screenshot)</h4>
                                <div className="bg-white p-6 rounded-[2rem] shadow-lg border-2 border-[#DED0B6] space-y-4">
                                    <div className="text-center border-b border-dashed border-[#DED0B6] pb-4">
                                        <h2 className="text-2xl font-black text-[#4A4238] tracking-tight">MY TRIP MEMORIES</h2>
                                        <p className="text-xs uppercase tracking-widest text-[#4A4238]/60">Chiang Mai ‚Ä¢ 2026</p>
                                    </div>
                                    <div className="space-y-4">
                                        {journalData.length === 0 ? <p className="text-center text-xs opacity-40">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p> : 
                                            journalData.map((entry, i) => (
                                                <div key={i} className="flex gap-3">
                                                    <div className="flex flex-col items-center">
                                                        <div className="w-2 h-2 bg-[#DED0B6] rounded-full mt-2"></div>
                                                        <div className="w-0.5 h-full bg-[#DED0B6]/30 my-1"></div>
                                                    </div>
                                                    <div className="pb-4 flex-1">
                                                        <div className="flex justify-between items-baseline">
                                                            <span className="text-[10px] font-bold opacity-50">{entry.dayDate}</span>
                                                            <span className="text-lg">{entry.journalMood}</span>
                                                        </div>
                                                        <h4 className="font-bold text-sm text-[#4A4238]">{entry.activity}</h4>
                                                        {entry.journalNote && <p className="text-xs text-gray-500 mt-1 italic">"{entry.journalNote}"</p>}
                                                        {entry.journalImage && <img src={entry.journalImage} className="mt-2 rounded-lg w-full h-32 object-cover" />}
                                                    </div>
                                                </div>
                                            ))
                                        }
                                    </div>
                                    <div className="text-center pt-4 border-t border-dashed border-[#DED0B6]">
                                        <p className="text-[10px] opacity-40">Created by CNX Planner</p>
                                    </div>
                                </div>
                                <p className="text-center text-[10px] opacity-50 mt-2">üëá ‡∏Å‡∏î‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('trip'); 
            const [activeDateTab, setActiveDateTab] = useState(0); 
            const [isShareOpen, setIsShareOpen] = useState(false);
            
            const [itineraryData, setItineraryData] = useState(() => {
                const saved = localStorage.getItem('cnx2026_itinerary_v5');
                return saved ? JSON.parse(saved) : INITIAL_ITINERARY;
            });

            const [gasTotal, setGasTotal] = useState(() => {
                const saved = localStorage.getItem('cnx2026_gas');
                return saved ? parseFloat(saved) : 0;
            });

            const [flightCost, setFlightCost] = useState(() => {
                const saved = localStorage.getItem('cnx2026_flight');
                return saved ? parseFloat(saved) : 0;
            });

            const [showGasInput, setShowGasInput] = useState(false);
            const [tempGas, setTempGas] = useState('');
            const [isEditingFlight, setIsEditingFlight] = useState(false);

            useEffect(() => localStorage.setItem('cnx2026_itinerary_v5', JSON.stringify(itineraryData)), [itineraryData]);
            useEffect(() => localStorage.setItem('cnx2026_gas', gasTotal), [gasTotal]);
            useEffect(() => localStorage.setItem('cnx2026_flight', flightCost), [flightCost]);

            const renderIcon = (type, color) => {
                const IconComp = Icons[type] || Icons.MapPin;
                return <IconComp className={color} />;
            };

            const resetData = () => {
                if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà?')) {
                    localStorage.clear();
                    window.location.reload();
                }
            };

            const handleToggleItem = (dayIdx, itemIdx) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    newDay.items[itemIdx] = { ...newDay.items[itemIdx], isOpen: !newDay.items[itemIdx].isOpen };
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleToggleDone = (dayIdx, itemIdx) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    newDay.items[itemIdx] = { ...newDay.items[itemIdx], completed: !newDay.items[itemIdx].completed };
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleAddItem = (dayIdx) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items, {
                        time: '??:??', activity: '', iconType: 'MapPin', iconColor: 'text-gray-500', location: '', link: '',
                        isOpen: true, isNew: true, completed: false, expenses: [], journalMood: '', journalNote: '', journalImage: null
                    }];
                    newData[dayIdx] = newDay;
                    return newData;
                });
                setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
            };

            const handleUpdateItem = (dayIdx, itemIdx, updatedData) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    newDay.items[itemIdx] = { ...newDay.items[itemIdx], ...updatedData };
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleDeleteItem = (dayIdx, itemIdx) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    newDay.items.splice(itemIdx, 1);
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleAddExpense = (dayIdx, itemIdx, note, amount) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    const newItem = { ...newDay.items[itemIdx] };
                    newItem.expenses = newItem.expenses ? [...newItem.expenses, { note, amount }] : [{ note, amount }];
                    newDay.items[itemIdx] = newItem;
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleDeleteExpense = (dayIdx, itemIdx, expenseIdx) => {
                setItineraryData(prev => {
                    const newData = [...prev];
                    const newDay = { ...newData[dayIdx] };
                    newDay.items = [...newDay.items];
                    const newItem = { ...newDay.items[itemIdx] };
                    newItem.expenses = [...newItem.expenses];
                    newItem.expenses.splice(expenseIdx, 1);
                    newDay.items[itemIdx] = newItem;
                    newData[dayIdx] = newDay;
                    return newData;
                });
            };

            const handleAddGas = () => {
                if (tempGas && !isNaN(tempGas)) {
                    setGasTotal(prev => prev + parseFloat(tempGas));
                    setTempGas('');
                    setShowGasInput(false);
                }
            };

            const totalActivityExpenses = useMemo(() => {
                let sum = 0;
                itineraryData.forEach(day => {
                    day.items.forEach(item => {
                        if(item.expenses) item.expenses.forEach(ex => sum += ex.amount);
                    });
                });
                return sum;
            }, [itineraryData]);

            const grandTotal = gasTotal + flightCost + totalActivityExpenses;

            // --- DATA FOR JOURNAL ---
            const journalEntries = useMemo(() => {
                const entries = [];
                itineraryData.forEach(day => {
                    day.items.forEach(item => {
                        if (item.journalNote || item.journalImage || item.journalMood) {
                            entries.push({ ...item, dayDate: day.dateShort });
                        }
                    });
                });
                return entries;
            }, [itineraryData]);

            const renderTripView = () => (
                <div className="animate-in fade-in duration-300">
                    <div className="sticky top-0 bg-[#F4EBE1]/95 backdrop-blur z-20 pt-2 pb-4 border-b border-[#DED0B6]/30 overflow-x-auto no-scrollbar">
                        <div className="flex justify-center gap-3 px-4">
                            {itineraryData.map((day, idx) => {
                                const isActive = activeDateTab === idx;
                                return (
                                    <button 
                                        key={idx} onClick={() => setActiveDateTab(idx)}
                                        className={`relative px-4 py-2 rounded-2xl text-sm font-bold transition-all duration-300 min-w-[80px] ${isActive ? 'bg-[#4A4238] text-[#F4EBE1] shadow-lg scale-105' : 'bg-white/50 text-[#4A4238]/60 hover:bg-white'}`}
                                    >
                                        {day.dateShort}
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                    <div className="mt-4 px-4 pb-24">
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-black text-[#4A4238] flex items-center gap-2">{itineraryData[activeDateTab].title}</h2>
                        </div>
                        <div className="relative ml-2 space-y-2 border-l-2 border-dashed border-[#DED0B6] pl-6 pb-2">
                            {itineraryData[activeDateTab].items.map((item, idx) => (
                                <ItineraryItem 
                                    key={idx} 
                                    item={{...item, icon: renderIcon(item.iconType, item.iconColor)}} 
                                    dayIndex={activeDateTab} itemIndex={idx} 
                                    onToggle={handleToggleItem} onAddExpense={handleAddExpense} onDeleteExpense={handleDeleteExpense} 
                                    onUpdateItem={handleUpdateItem} onDeleteItem={handleDeleteItem} onToggleDone={handleToggleDone}
                                />
                            ))}
                        </div>
                        <button onClick={() => handleAddItem(activeDateTab)} className="mt-4 w-full py-4 border-2 border-dashed border-[#DED0B6] rounded-2xl text-[#4A4238]/50 font-bold flex items-center justify-center gap-2 hover:bg-white/50 hover:text-[#4A4238] transition-all active:scale-95">
                            <Icons.Plus size={20} /> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                        </button>
                    </div>
                </div>
            );

            const renderExpensesView = () => (
                <div className="px-4 py-6 animate-in slide-in-from-bottom-4 duration-300 pb-24">
                    <h2 className="text-2xl font-black text-[#4A4238] mb-6 pl-2 border-l-4 border-[#4A4238]">Wallet & Expenses</h2>
                    <div className="bg-[#4A4238] text-[#F4EBE1] p-6 rounded-[2.5rem] shadow-xl mb-6 relative overflow-hidden">
                        <div className="absolute -top-10 -right-10 w-40 h-40 bg-white/5 rounded-full blur-2xl"></div>
                        <p className="text-sm font-bold opacity-60 uppercase tracking-widest mb-1">Total Spent</p>
                        <p className="text-4xl font-black">‡∏ø{grandTotal.toLocaleString()}</p>
                        <div className="flex items-center gap-1 text-[10px] mt-2 opacity-50"><Icons.Save size={10}/> Auto-saved</div>
                    </div>
                    <div className="space-y-4">
                        <div className="bg-white p-4 rounded-2xl border border-[#DED0B6] shadow-sm flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="p-3 bg-red-100 text-red-500 rounded-xl"><Icons.Plane size={20}/></div>
                                <div><p className="font-bold text-[#4A4238]">‡∏ï‡∏±‡πã‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô</p></div>
                            </div>
                            {isEditingFlight ? (
                                <input type="number" className="w-24 p-2 bg-slate-50 border rounded text-right font-mono outline-none" value={flightCost === 0 ? '' : flightCost} placeholder="0" onChange={(e) => setFlightCost(parseFloat(e.target.value) || 0)} onBlur={() => setIsEditingFlight(false)} autoFocus />
                            ) : (
                                <div onClick={() => setIsEditingFlight(true)} className="cursor-pointer font-mono font-bold text-lg">{flightCost === 0 ? <span className="text-xs text-red-400 bg-red-50 px-2 py-1 rounded">‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤</span> : `‡∏ø${flightCost.toLocaleString()}`}</div>
                            )}
                        </div>
                        <div className="bg-white p-4 rounded-2xl border border-[#DED0B6] shadow-sm">
                            <div className="flex justify-between items-center mb-2">
                                <div className="flex items-center gap-3">
                                    <div className="p-3 bg-blue-100 text-blue-500 rounded-xl"><Icons.Fuel size={20}/></div>
                                    <div><p className="font-bold text-[#4A4238]">‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</p></div>
                                </div>
                                <span className="font-mono font-bold text-lg">‡∏ø{gasTotal.toLocaleString()}</span>
                            </div>
                            {!showGasInput ? (
                                <button onClick={() => setShowGasInput(true)} className="w-full py-2 text-xs font-bold text-blue-500 bg-blue-50 rounded-xl hover:bg-blue-100 transition-colors">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                            ) : (
                                <div className="flex gap-2 mt-2">
                                    <input type="number" className="flex-1 p-2 bg-slate-50 border rounded text-sm" autoFocus onChange={e => setTempGas(e.target.value)} placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î..." />
                                    <button onClick={handleAddGas} className="bg-blue-500 text-white rounded-lg px-4 font-bold shadow-sm">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                </div>
                            )}
                        </div>
                        <div className="bg-white p-4 rounded-2xl border border-[#DED0B6] shadow-sm">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="p-3 bg-green-100 text-green-600 rounded-xl"><Icons.Coins size={20}/></div>
                                <div><p className="font-bold text-[#4A4238]">‡∏Å‡∏¥‡∏ô / ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß / ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p></div>
                            </div>
                            <div className="space-y-3">
                                {itineraryData.map((day, idx) => {
                                    const dayTotal = day.items.reduce((sum, item) => sum + (item.expenses ? item.expenses.reduce((s, e) => s + e.amount, 0) : 0), 0);
                                    if(dayTotal === 0) return null;
                                    return (
                                        <div key={idx} className="flex justify-between items-center text-sm border-b border-dashed border-gray-100 pb-2 last:border-0 last:pb-0">
                                            <span className="opacity-60">{day.dateShort}</span>
                                            <span className="font-mono font-bold">‡∏ø{dayTotal.toLocaleString()}</span>
                                        </div>
                                    );
                                })}
                                {totalActivityExpenses === 0 && <p className="text-center text-xs opacity-30 py-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</p>}
                            </div>
                            <div className="mt-4 pt-3 border-t flex justify-between items-center">
                                <span className="text-xs font-bold uppercase opacity-50">Subtotal</span>
                                <span className="font-mono font-bold text-green-600">‡∏ø{totalActivityExpenses.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderExploreView = () => (
                <div className="px-4 py-6 animate-in slide-in-from-bottom-4 duration-300 pb-24">
                    <h2 className="text-2xl font-black text-[#4A4238] mb-6 pl-2 border-l-4 border-[#4A4238]">Nearby & Tools</h2>
                    <div className="grid grid-cols-1 gap-4 mb-6">
                        <button onClick={() => window.open('https://www.google.com/maps/search/restaurant/')} className="bg-white p-6 rounded-2xl border border-[#DED0B6] shadow-sm flex items-center gap-4 hover:bg-orange-50 transition-colors group">
                            <div className="p-4 bg-orange-100 text-orange-500 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Utensils size={32} /></div>
                            <div className="text-left"><h3 className="text-lg font-black text-[#4A4238]">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3><p className="text-xs opacity-60">Restaurants Near Me</p></div>
                            <Icons.ChevronRight className="ml-auto opacity-30" />
                        </button>
                        <button onClick={() => window.open('https://www.google.com/maps/search/tourist+attraction/')} className="bg-white p-6 rounded-2xl border border-[#DED0B6] shadow-sm flex items-center gap-4 hover:bg-green-50 transition-colors group">
                            <div className="p-4 bg-green-100 text-green-500 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Camera size={32} /></div>
                            <div className="text-left"><h3 className="text-lg font-black text-[#4A4238]">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</h3><p className="text-xs opacity-60">Attractions Near Me</p></div>
                            <Icons.ChevronRight className="ml-auto opacity-30" />
                        </button>
                        <button onClick={() => window.open('https://www.google.com/maps/search/gas+station/')} className="bg-white p-6 rounded-2xl border border-[#DED0B6] shadow-sm flex items-center gap-4 hover:bg-blue-50 transition-colors group">
                            <div className="p-4 bg-blue-100 text-blue-500 rounded-2xl group-hover:scale-110 transition-transform"><Icons.Fuel size={32} /></div>
                            <div className="text-left"><h3 className="text-lg font-black text-[#4A4238]">‡∏õ‡∏±‡πä‡∏°‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h3><p className="text-xs opacity-60">Gas Stations Near Me</p></div>
                            <Icons.ChevronRight className="ml-auto opacity-30" />
                        </button>
                    </div>

                    <button onClick={resetData} className="mt-8 w-full py-3 text-red-400 text-xs font-bold bg-white border border-red-100 rounded-xl hover:bg-red-50">
                        Reset All Data (‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
                    </button>
                </div>
            );

            const renderJournalView = () => {
                return (
                    <div className="px-4 py-6 animate-in slide-in-from-bottom-4 duration-300 pb-24 relative">
                        <div className="flex justify-between items-start mb-6 border-l-4 border-[#4A4238] pl-2">
                            <h2 className="text-2xl font-black text-[#4A4238]">Travel Memories</h2>
                            <button onClick={() => setIsShareOpen(true)} className="bg-[#4A4238] text-white p-2 rounded-full shadow-lg active:scale-95"><Icons.Share size={20}/></button>
                        </div>
                        
                        {journalEntries.length === 0 ? (
                            <div className="text-center py-20 opacity-40">
                                <Icons.BookOpen size={64} className="mx-auto mb-4"/>
                                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥</p>
                                <p className="text-xs">‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Trip ‡∏î‡∏π‡∏™‡∏¥</p>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {journalEntries.map((entry, idx) => (
                                    <div key={idx} className="bg-white rounded-[2rem] shadow-sm border border-[#DED0B6] overflow-hidden">
                                        {entry.journalImage && (
                                            <div className="w-full h-48 overflow-hidden bg-gray-100">
                                                <img src={entry.journalImage} className="w-full h-full object-cover" />
                                            </div>
                                        )}
                                        <div className="p-5">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <span className="text-[10px] bg-yellow-100 text-yellow-700 px-2 py-1 rounded-lg font-bold uppercase tracking-wider">{entry.dayDate} ‚Ä¢ {entry.time}</span>
                                                    <h3 className="font-bold text-lg mt-1 text-[#4A4238]">{entry.activity}</h3>
                                                </div>
                                                {entry.journalMood && <div className="text-3xl bg-gray-50 p-2 rounded-xl">{entry.journalMood}</div>}
                                            </div>
                                            {entry.journalNote && (
                                                <div className="bg-[#F4EBE1]/50 p-4 rounded-xl text-sm text-gray-600 leading-relaxed italic relative">
                                                    <span className="absolute top-2 left-2 text-2xl opacity-20">"</span>
                                                    {entry.journalNote}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                        <ShareModal isOpen={isShareOpen} onClose={() => setIsShareOpen(false)} journalData={journalEntries} />
                    </div>
                );
            };

            return (
                <div className="min-h-[100dvh] bg-[#F4EBE1] text-[#4A4238] font-sans relative">
                    <div className="bg-[#F4EBE1] safe-top">
                        <div className="max-w-lg mx-auto p-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-black tracking-tight">CNX 2026</h1>
                                <p className="text-[10px] font-bold opacity-50 uppercase tracking-widest">Chiang Mai Trip</p>
                            </div>
                            <div className="bg-[#DED0B6] p-2 rounded-full shadow-inner opacity-50"><Icons.Leaf size={16} /></div>
                        </div>
                        <div className="px-4 pb-2">
                             <div className="bg-orange-500 text-white p-3 rounded-2xl shadow-lg shadow-orange-500/20 flex items-center gap-3 text-xs">
                                <div className="bg-white/20 p-2 rounded-xl"><Icons.Plane className="animate-pulse" size={16} /></div>
                                <div><p className="font-bold">Late Arrival 11:10</p><p className="opacity-90">Auto-Save Enabled</p></div>
                            </div>
                        </div>
                    </div>
                    <div className="max-w-lg mx-auto min-h-screen">
                        {view === 'trip' && renderTripView()}
                        {view === 'explore' && renderExploreView()}
                        {view === 'memories' && renderJournalView()}
                        {view === 'expenses' && renderExpensesView()}
                    </div>
                    <div className="fixed bottom-0 w-full bg-white/90 backdrop-blur-md border-t border-[#DED0B6]/50 safe-bottom z-50">
                        <div className="max-w-lg mx-auto flex justify-around items-center p-2">
                            <button onClick={() => setView('trip')} className={`flex flex-col items-center p-2 rounded-xl transition-all w-16 ${view === 'trip' ? 'text-[#4A4238] scale-105' : 'text-gray-400'}`}>
                                <div className={`p-1 rounded-full mb-1 ${view === 'trip' ? 'bg-[#F4EBE1]' : ''}`}><Icons.Map size={24} /></div>
                                <span className="text-[9px] font-bold uppercase">Trip</span>
                            </button>
                            <button onClick={() => setView('memories')} className={`flex flex-col items-center p-2 rounded-xl transition-all w-16 ${view === 'memories' ? 'text-[#4A4238] scale-105' : 'text-gray-400'}`}>
                                <div className={`p-1 rounded-full mb-1 ${view === 'memories' ? 'bg-[#F4EBE1]' : ''}`}><Icons.BookOpen size={24} /></div>
                                <span className="text-[9px] font-bold uppercase">Memory</span>
                            </button>
                            <button onClick={() => setView('expenses')} className={`flex flex-col items-center p-2 rounded-xl transition-all w-16 ${view === 'expenses' ? 'text-[#4A4238] scale-105' : 'text-gray-400'}`}>
                                <div className={`p-1 rounded-full mb-1 ${view === 'expenses' ? 'bg-[#F4EBE1]' : ''}`}><Icons.Wallet size={24} /></div>
                                <span className="text-[9px] font-bold uppercase">Wallet</span>
                            </button>
                            <button onClick={() => setView('explore')} className={`flex flex-col items-center p-2 rounded-xl transition-all w-16 ${view === 'explore' ? 'text-[#4A4238] scale-105' : 'text-gray-400'}`}>
                                <div className={`p-1 rounded-full mb-1 ${view === 'explore' ? 'bg-[#F4EBE1]' : ''}`}><Icons.Settings size={24} /></div>
                                <span className="text-[9px] font-bold uppercase">More</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Item Manager - GitHub Edition</title>
    <!-- External Libraries for Image Tracing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/potrace/1.1.2/potrace.min.js"></script>
    <style>
        :root {
            --sidebar-width: 260px;
            --bg-dark: #121026;
            --card-bg: rgba(255, 255, 255, 0.05);
            --accent-color: #7c5cdb;
            --warp-blue: #4eeaf6;
            --input-bg: rgba(255, 255, 255, 0.08);
            --danger-color: #ef4444;
            --success-color: #10b981;
            --warning-color: #f59e0b;
        }

        body {
            display: flex;
            min-height: 100vh;
            margin: 0;
            background-color: var(--bg-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow-x: hidden;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #1a1635;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 18px;
            color: var(--accent-color);
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .lang-toggle {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .btn-lang {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 11px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-lang.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
        }

        .menu-scroll {
            flex: 1;
            overflow-y: auto;
        }

        .menu-group { padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .menu-label { padding: 10px 25px; font-size: 11px; text-transform: uppercase; color: rgba(255, 255, 255, 0.4); letter-spacing: 2px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }

        .btn-add-cat { cursor: pointer; color: var(--accent-color); font-size: 16px; transition: 0.2s; }
        .btn-add-cat:hover { transform: scale(1.2); }

        .menu-item {
            padding: 12px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.7);
            border-left: 3px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(124, 92, 219, 0.1);
            color: white;
            border-left-color: var(--accent-color);
        }

        .menu-item.drag-over {
            background: rgba(78, 234, 246, 0.1);
            border-left-color: var(--warp-blue);
            transform: translateX(5px);
        }

        /* Main Display Area */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 40px;
            transition: all 0.3s;
        }

        .section-title {
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title h1 { margin: 0; font-size: 28px; }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        /* Card Component */
        .item-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s, background 0.3s, opacity 0.3s;
            position: relative;
            cursor: grab;
        }

        .item-card:active { cursor: grabbing; }
        .item-card.dragging { opacity: 0.4; transform: scale(0.95); }

        .item-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(124, 92, 219, 0.3);
        }

        .svg-display {
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 20px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .svg-display svg { max-width: 100%; max-height: 100%; }
        .svg-display.flipped { transform: scaleX(-1); }

        .item-card h3 { margin: 0 0 15px 0; font-size: 17px; color: #eee; text-align: center; pointer-events: none; }

        .btn-row { display: flex; gap: 8px; width: 100%; margin-top: 5px; }
        
        .btn-action {
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-copy-main { flex: 1; background: var(--accent-color); color: white; }
        .btn-flip { width: 45px; background: rgba(255,255,255,0.1); color: white; }
        .btn-delete { width: 45px; background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .btn-delete:hover { background: var(--danger-color); color: white; }

        .btn-restore { background: var(--success-color); color: white; flex: 1; }
        .btn-permanent { background: var(--danger-color); color: white; flex: 1; }
        .btn-warning { background: var(--warning-color); color: white; flex: 1; }

        /* Import Section Styles */
        .import-dropzone {
            border: 2px dashed rgba(255,255,255,0.1);
            padding: 40px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            background: rgba(255,255,255,0.02);
            transition: 0.3s;
            margin-bottom: 20px;
        }

        .import-dropzone:hover {
            border-color: var(--accent-color);
            background: rgba(124, 92, 219, 0.05);
        }

        .preview-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .preview-box {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .preview-box img, .preview-box svg {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
        }

        .mode-toggle {
            display: flex;
            background: var(--input-bg);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
        }

        .mode-btn.active {
            background: var(--accent-color);
            color: white;
        }

        /* Toast Notification */
        .msg-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-color);
            padding: 12px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }
        .msg-toast.show { opacity: 1; transform: translateY(-10px); }

        /* Modal Overlay */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #1a1635; padding: 30px; border-radius: 20px; width: 450px; border: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }

        .hidden { display: none; }

        /* Input Elements */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: rgba(255,255,255,0.6); font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            background: var(--input-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: white;
            font-family: inherit;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar-header h2, .menu-label, .menu-item .label-text, .lang-toggle { display: none; }
            .main-content { margin-left: 70px; padding: 20px; }
            .menu-item { justify-content: center; padding: 15px; font-size: 24px; }
        }
    </style>
</head>
<body>

    <!-- Modal: Add Category -->
    <div id="modal-category" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-cat-title">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="form-group">
                <label id="lbl-cat-name">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                <input type="text" id="cat-name-input" placeholder="...">
            </div>
            <div class="form-group">
                <label id="lbl-cat-icon">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Emoji)</label>
                <input type="text" id="cat-icon-input" placeholder="‚öîÔ∏è">
            </div>
            <div class="btn-row">
                <button class="btn-action btn-copy-main" onclick="saveCategory()" id="btn-save-cat">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button class="btn-action btn-flip" onclick="closeModal('modal-category')" id="btn-cancel-cat">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Modal: Restore System -->
    <div id="modal-restore" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-restore-title">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Restore)</h3>
            <p style="font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 15px;" id="restore-warn">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
            <div class="form-group">
                <label id="lbl-restore-json">‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™ Backup JSON ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</label>
                <textarea id="restore-input" style="height: 150px; font-family: monospace;" placeholder='{"categories": [...], "items": [...]}'></textarea>
            </div>
            <div class="btn-row">
                <button class="btn-action btn-warning" onclick="processRestore()" id="btn-do-restore">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn-action btn-flip" onclick="closeModal('modal-restore')" id="btn-close-restore">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ITEM DB</h2>
            <div class="lang-toggle">
                <button class="btn-lang active" id="lang-th" onclick="setLanguage('th')">TH</button>
                <button class="btn-lang" id="lang-en" onclick="setLanguage('en')">EN</button>
            </div>
        </div>
        <div class="menu-scroll">
            <div class="menu-group">
                <div class="menu-label">
                    <span id="label-categories">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</span>
                    <span class="btn-add-cat" onclick="openModal('modal-category')" title="Add Category">‚äï</span>
                </div>
                <div id="sidebar-categories">
                    <!-- Dynamic Categories -->
                </div>
            </div>

            <div class="menu-group">
                <div class="menu-label" id="label-manage">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</div>
                <div class="menu-item" onclick="showSection('add-item', this)">
                    <span>‚ûï</span>
                    <span class="label-text" id="menu-add-item">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà</span>
                </div>
                <div class="menu-item" onclick="showSection('import-image', this)">
                    <span>üñºÔ∏è</span>
                    <span class="label-text" id="menu-import">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                </div>
                <div class="menu-item" onclick="showSection('trash-bin', this)">
                    <span>üóëÔ∏è</span>
                    <span class="label-text" id="menu-trash">‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</span>
                </div>
            </div>

            <div class="menu-group">
                <div class="menu-label" id="label-backup">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                <div class="menu-item" onclick="backupAll()">
                    <span>üíæ</span>
                    <span class="label-text" id="menu-backup">Backup (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</span>
                </div>
                <div class="menu-item" onclick="openModal('modal-restore')">
                    <span>üîÑ</span>
                    <span class="label-text" id="menu-restore">Restore ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        
        <!-- Category View Section -->
        <div id="section-category-view" class="content-section">
            <div class="section-title">
                <h1 id="view-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</h1>
            </div>
            <div class="item-grid" id="items-display-grid">
                <!-- Items injected here -->
            </div>
        </div>

        <!-- Add New Item Section (Manual) -->
        <div id="section-add-item" class="hidden content-section">
            <div class="section-title"><h1 id="title-add-new">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</h1></div>
            <div style="max-width: 600px; background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px;">
                <div class="form-group">
                    <label id="lbl-item-name">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</label>
                    <input type="text" id="new-item-name" placeholder="...">
                </div>
                <div class="form-group">
                    <label id="lbl-item-cat">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="new-item-category">
                        <!-- Categories injected here -->
                    </select>
                </div>
                <div class="form-group">
                    <label id="lbl-item-svg">‡πÇ‡∏Ñ‡πâ‡∏î SVG</label>
                    <textarea id="new-item-svg" style="height: 150px; font-family: monospace;" placeholder="<svg>...</svg>"></textarea>
                </div>
                <button class="btn-action btn-copy-main" onclick="createNewItem()" id="btn-save-item">‚ú® ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</button>
            </div>
        </div>

        <!-- Import Image Section -->
        <div id="section-import-image" class="hidden content-section">
            <div class="section-title"><h1 id="title-import">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h1></div>
            <div style="max-width: 800px; background: rgba(255,255,255,0.03); padding: 30px; border-radius: 20px;">
                
                <div class="mode-toggle">
                    <button class="mode-btn active" id="mode-embed" onclick="setImportMode('embed')">Embed (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏µ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)</button>
                    <button class="mode-btn" id="mode-trace" onclick="setImportMode('trace')">Trace (‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô Vector)</button>
                </div>

                <div class="import-dropzone" onclick="document.getElementById('file-input').click()">
                    <p id="dropzone-text">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (PNG, JPG, SVG)</p>
                    <input type="file" id="file-input" class="hidden" accept="image/*" onchange="handleFileSelect(event)">
                </div>

                <div id="import-preview-area" class="hidden">
                    <div class="preview-container">
                        <div class="preview-box">
                            <label>Original Preview</label>
                            <img id="img-preview" src="">
                        </div>
                        <div class="preview-box">
                            <label>Generated SVG</label>
                            <div id="svg-preview-cont"></div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <div class="form-group">
                            <label id="lbl-import-name">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</label>
                            <input type="text" id="import-item-name" placeholder="...">
                        </div>
                        <div class="form-group">
                            <label id="lbl-import-cat">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                            <select id="import-item-category"></select>
                        </div>
                        <button class="btn-action btn-copy-main" onclick="saveImportedItem()">‚ú® ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trash Bin Section -->
        <div id="section-trash-bin" class="hidden content-section">
            <div class="section-title"><h1 id="title-trash">‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</h1></div>
            <div class="item-grid" id="trash-display-grid">
                <!-- Trash items injected here -->
            </div>
        </div>

    </div>

    <!-- Toast Message -->
    <div id="toast" class="msg-toast">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>

    <script>
        const translations = {
            th: {
                categories: "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà", manage: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°", addItem: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏´‡∏°‡πà",
                trash: "‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞", backup: "‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", backupBtn: "Backup (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)",
                restoreBtn: "Restore ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", viewTitle: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡∏°", noItems: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ",
                trashEmpty: "‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤", addTitle: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏ß‡∏ó‡∏°‡∏ô‡∏ï‡∏£‡πå‡πÉ‡∏´‡∏°‡πà", restoreTitle: "‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö",
                restoreWarn: "‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ", save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
                close: "‡∏õ‡∏¥‡∏î", restoreDo: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", lblItemName: "‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°", lblItemCat: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà",
                lblItemSvg: "‡πÇ‡∏Ñ‡πâ‡∏î SVG", lblCatName: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà", lblCatIcon: "‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Emoji)",
                lblRestoreJson: "‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™ Backup JSON ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà", copy: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å", restore: "‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô",
                delForever: "‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£", toastSuccess: "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", toastCopy: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å SVG ‡πÅ‡∏•‡πâ‡∏ß!",
                toastBackup: "‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Clipboard ‡πÅ‡∏•‡πâ‡∏ß!", toastRestore: "‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
                toastRestoreErr: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö!", toastMovedTrash: "‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡πÅ‡∏•‡πâ‡∏ß",
                toastItemAdded: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", toastCatAdded: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß!",
                moveSuccess: "‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", import: "‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û",
                dropzone: "‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (PNG, JPG, SVG)", lblImportName: "‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡∏°", lblImportCat: "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà"
            },
            en: {
                categories: "Categories", manage: "Management", addItem: "Add New Item",
                trash: "Trash Bin", backup: "Backup System", backupBtn: "Backup All (Copy)",
                restoreBtn: "Restore System", viewTitle: "Item List", noItems: "No items in this category",
                trashEmpty: "Trash bin is empty", addTitle: "Add New Magic Item", restoreTitle: "Restore Data System",
                restoreWarn: "Warning: Restore will overwrite all current data", save: "Save", cancel: "Cancel",
                close: "Close", restoreDo: "Process Restore", lblItemName: "Item Name", lblItemCat: "Select Category",
                lblItemSvg: "SVG Code", lblCatName: "Category Name", lblCatIcon: "Icon (Emoji)",
                lblRestoreJson: "Paste Backup JSON here", copy: "Copy", restore: "Restore",
                delForever: "Delete Forever", toastSuccess: "Success!", toastCopy: "SVG Copied!",
                toastBackup: "Backup copied to clipboard!", toastRestore: "Restore successful!",
                toastRestoreErr: "Invalid JSON format!", toastMovedTrash: "Moved to trash",
                toastItemAdded: "Item added successfully!", toastCatAdded: "New category added!",
                moveSuccess: "Item moved!", import: "Import Icon/Image",
                dropzone: "Click or Drop image here (PNG, JPG, SVG)", lblImportName: "Item Name", lblImportCat: "Category"
            }
        };

        let currentLang = 'th';
        let categories = [
            { id: 'cat-consumables', name: '‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏Å‡∏î‡πÉ‡∏ä‡πâ', icon: 'üì¶' },
            { id: 'cat-treasures', name: '‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏•‡πâ‡∏≥‡∏Ñ‡πà‡∏≤', icon: 'üíé' }
        ];
        let items = [];
        let trash = [];
        let currentCatId = 'cat-consumables';
        let draggedItemId = null;
        let importMode = 'embed';
        let currentGeneratedSvg = '';

        // --- Init ---

        function init() {
            applyLanguage();
            renderSidebar();
            renderCategorySelect();
            renderItems();
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.btn-lang').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${lang}`).classList.add('active');
            applyLanguage();
            renderSidebar();
            renderItems();
        }

        function applyLanguage() {
            const t = translations[currentLang];
            const ids = {
                'label-categories': t.categories, 'label-manage': t.manage,
                'menu-add-item': t.addItem, 'menu-import': t.import, 'menu-trash': t.trash,
                'label-backup': t.backup, 'menu-backup': t.backupBtn, 'menu-restore': t.restoreBtn,
                'title-add-new': t.addTitle, 'title-import': t.import, 'title-trash': t.trash,
                'lbl-item-name': t.lblItemName, 'lbl-item-cat': t.lblItemCat, 'lbl-item-svg': t.lblItemSvg,
                'btn-save-item': "‚ú® " + t.save, 'modal-cat-title': t.categories,
                'lbl-cat-name': t.lblCatName, 'lbl-cat-icon': t.lblCatIcon,
                'btn-save-cat': t.save, 'btn-cancel-cat': t.cancel, 'modal-restore-title': t.restoreTitle,
                'restore-warn': t.restoreWarn, 'lbl-restore-json': t.lblRestoreJson,
                'btn-do-restore': t.restoreDo, 'btn-close-restore': t.close,
                'dropzone-text': t.dropzone, 'lbl-import-name': t.lblImportName, 'lbl-import-cat': t.lblImportCat
            };
            for (let id in ids) if (document.getElementById(id)) document.getElementById(id).innerText = ids[id];
        }

        // --- Sidebar & Section Switch ---

        function renderSidebar() {
            const container = document.getElementById('sidebar-categories');
            container.innerHTML = categories.map(cat => `
                <div class="menu-item ${cat.id === currentCatId ? 'active' : ''}" 
                     onclick="selectCategory('${cat.id}', this)"
                     ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event, '${cat.id}')">
                    <span>${cat.icon}</span>
                    <span class="label-text">${cat.name}</span>
                </div>
            `).join('');
        }

        function selectCategory(id, el) {
            currentCatId = id;
            showSection('category-view', el);
            const cat = categories.find(c => c.id === id);
            document.getElementById('view-title').innerText = cat ? `${cat.icon} ${cat.name}` : translations[currentLang].viewTitle;
            renderItems();
        }

        function showSection(name, menuItem) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`section-${name}`).classList.remove('hidden');
            if (menuItem) {
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                menuItem.classList.add('active');
            }
            if(name === 'trash-bin') renderTrash();
        }

        // --- Image Import System ---

        function setImportMode(mode) {
            importMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`mode-${mode}`).classList.add('active');
            // Re-process current image if exists
            const img = document.getElementById('img-preview');
            if (img.src) processFile(img.src);
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (re) => {
                const dataUrl = re.target.result;
                document.getElementById('img-preview').src = dataUrl;
                document.getElementById('import-preview-area').classList.remove('hidden');
                processFile(dataUrl);
            };
            reader.readAsDataURL(file);
        }

        function processFile(dataUrl) {
            if (importMode === 'embed') {
                // Method 1: Embedding
                currentGeneratedSvg = `<svg width="200" height="200" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                    <image href="${dataUrl}" x="0" y="0" width="200" height="200" preserveAspectRatio="xMidYMid meet" />
                </svg>`;
                document.getElementById('svg-preview-cont').innerHTML = currentGeneratedSvg;
            } else {
                // Method 2: Tracing using Potrace
                const img = new Image();
                img.src = dataUrl;
                img.onload = () => {
                    Potrace.loadImage(img);
                    Potrace.process(() => {
                        currentGeneratedSvg = Potrace.getSVG();
                        document.getElementById('svg-preview-cont').innerHTML = currentGeneratedSvg;
                    });
                };
            }
        }

        function saveImportedItem() {
            const name = document.getElementById('import-item-name').value;
            const catId = document.getElementById('import-item-category').value;
            if (!name || !currentGeneratedSvg) return;
            const newItem = { id: 'item-' + Date.now(), catId, name, svg: currentGeneratedSvg };
            items.push(newItem);
            toast(translations[currentLang].toastItemAdded);
            document.getElementById('import-preview-area').classList.add('hidden');
            document.getElementById('import-item-name').value = '';
            init();
        }

        // --- Core Item Logic & Drag & Drop ---

        function handleDragStart(e, id) { draggedItemId = id; e.target.classList.add('dragging'); }
        function handleDragEnd(e) { e.target.classList.remove('dragging'); draggedItemId = null; }
        function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        function handleDragLeave(e) { e.currentTarget.classList.remove('drag-over'); }
        function handleDrop(e, catId) {
            e.preventDefault(); e.currentTarget.classList.remove('drag-over');
            if (draggedItemId) {
                const item = items.find(i => i.id === draggedItemId);
                if (item && item.catId !== catId) {
                    item.catId = catId;
                    toast(translations[currentLang].moveSuccess);
                    renderItems(); renderSidebar();
                }
            }
        }

        function renderItems() {
            const grid = document.getElementById('items-display-grid');
            const filtered = items.filter(i => i.catId === currentCatId);
            const t = translations[currentLang];
            if (filtered.length === 0) { grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; opacity: 0.3; padding: 40px;">${t.noItems}</div>`; return; }
            grid.innerHTML = filtered.map(item => `
                <div class="item-card" draggable="true" ondragstart="handleDragStart(event, '${item.id}')" ondragend="handleDragEnd(event)">
                    <h3>${item.name}</h3>
                    <div class="svg-display" id="svg-cont-${item.id}">${item.svg}</div>
                    <div class="btn-row">
                        <button class="btn-action btn-copy-main" onclick="copySVG('${item.id}')">${t.copy}</button>
                        <button class="btn-action btn-flip" onclick="flipItem('${item.id}')">‚ÜîÔ∏è</button>
                        <button class="btn-action btn-delete" onclick="moveToTrash('${item.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderTrash() {
            const grid = document.getElementById('trash-display-grid');
            const t = translations[currentLang];
            if (trash.length === 0) { grid.innerHTML = `<div style="grid-column: 1/-1; text-align: center; opacity: 0.3; padding: 40px;">${t.trashEmpty}</div>`; return; }
            grid.innerHTML = trash.map(item => `
                <div class="item-card">
                    <h3>${item.name}</h3><div class="svg-display">${item.svg}</div>
                    <div class="btn-row">
                        <button class="btn-action btn-restore" onclick="restoreFromTrash('${item.id}')">${t.restore}</button>
                        <button class="btn-action btn-permanent" onclick="permanentDelete('${item.id}')">${t.delForever}</button>
                    </div>
                </div>
            `).join('');
        }

        function renderCategorySelect() {
            const html = categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
            document.getElementById('new-item-category').innerHTML = html;
            document.getElementById('import-item-category').innerHTML = html;
        }

        function createNewItem() {
            const name = document.getElementById('new-item-name').value;
            const catId = document.getElementById('new-item-category').value;
            const svg = document.getElementById('new-item-svg').value;
            if(!name || !svg) return;
            items.push({ id: 'item-' + Date.now(), catId, name, svg });
            document.getElementById('new-item-name').value = '';
            document.getElementById('new-item-svg').value = '';
            toast(translations[currentLang].toastItemAdded);
            init();
        }

        function moveToTrash(id) { trash.push(items.splice(items.findIndex(i => i.id === id), 1)[0]); renderItems(); toast(translations[currentLang].toastMovedTrash); }
        function restoreFromTrash(id) { items.push(trash.splice(trash.findIndex(i => i.id === id), 1)[0]); renderTrash(); toast(translations[currentLang].toastSuccess); }
        function permanentDelete(id) { trash.splice(trash.findIndex(i => i.id === id), 1); renderTrash(); toast(translations[currentLang].toastSuccess); }
        function flipItem(id) { document.getElementById(`svg-cont-${id}`).classList.toggle('flipped'); }
        function copySVG(id) { copyToClipboard(document.getElementById(`svg-cont-${id}`).innerHTML.trim()); toast(translations[currentLang].toastCopy); }

        function backupAll() { copyToClipboard(JSON.stringify({ categories, items })); toast(translations[currentLang].toastBackup); }
        function processRestore() {
            try {
                const data = JSON.parse(document.getElementById('restore-input').value);
                if(data.categories && data.items) {
                    categories = data.categories; items = data.items; trash = []; currentCatId = categories[0].id;
                    init(); closeModal('modal-restore'); toast(translations[currentLang].toastRestore);
                }
            } catch (e) { toast(translations[currentLang].toastRestoreErr); }
        }

        function copyToClipboard(text) { const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function saveCategory() {
            const name = document.getElementById('cat-name-input').value;
            const icon = document.getElementById('cat-icon-input').value || 'üìÅ';
            if(!name) return;
            categories.push({ id: 'cat-' + Date.now(), name, icon });
            document.getElementById('cat-name-input').value = '';
            init(); closeModal('modal-category'); toast(translations[currentLang].toastCatAdded);
        }
        function toast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }

        window.onload = init;
    </script>
</body>
</html>
